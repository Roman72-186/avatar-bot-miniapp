{
  "permissions": {
    "allow": [
      "Bash(python3:*)",
      "Bash($body = Get-Content -Raw \"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\n8n_payment_handler.json\")",
      "Bash($headers = @{\"X-N8N-API-KEY\"=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\")",
      "Bash(\"Content-Type\"=\"application/json\"})",
      "Bash(Invoke-RestMethod -Uri \"https://n8n.creativeanalytic.ru/api/v1/workflows\" -Method POST -Headers $headers -Body $body)",
      "Bash(ConvertTo-Json -Depth 10)",
      "Bash(npm run build:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "WebFetch(domain:docs.fal.ai)",
      "Bash(timeout:*)",
      "Bash(npx vite:*)",
      "Bash(dir:*)",
      "Bash(git status:*)",
      "Bash(git reset:*)",
      "WebFetch(domain:v3b.fal.media)",
      "Bash(ls:*)",
      "Bash(del:*)",
      "Bash(/tmp/check_workflows.py:*)",
      "Bash(npx vercel:*)",
      "Bash(ping:*)",
      "Bash(features and identity, apply art style and colors from the)",
      "Bash(reference image, keep the same person\"\n\nПеревод \\(RU\\):\n\"перенести лицо с фото обязательно, сохранить черты лица)",
      "Bash(и идентичность, применить художественный стиль и цвета)",
      "Bash(с референсного изображения, сохранить того же человека\"\n\nОбновлённые параметры:\n- strength: 0.75 \\(было 0.85\\) - больше сохранения лица\n- ip_adapter_weight: 0.85 \\(было 0.8\\) - сильнее перенос стиля\n- num_inference_steps: 30 \\(было 25\\) - выше качество\n\nРезультат:\n✅ Лицо с первого фото переносится точно\n✅ Стиль берётся со второго фото \\(референса\\)\n✅ Лучший баланс сохранения/стилизации\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(pip install:*)",
      "Bash(more:*)",
      "Bash(grep:*)",
      "Bash(find:*)",
      "WebFetch(domain:telegram.org)",
      "WebFetch(domain:habr.com)",
      "Bash(PYTHONUTF8=1 python -c \"\nimport json, urllib.request, ssl\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\nAPI_KEY = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY''\nN8N = ''https://n8n.creativeanalytic.ru''\n\nreq = urllib.request.Request\\(f''{N8N}/api/v1/executions/5322''\\)\nreq.add_header\\(''X-N8N-API-KEY'', API_KEY\\)\nresp = urllib.request.urlopen\\(req, context=ctx\\)\nex = json.loads\\(resp.read\\(\\).decode\\(\\)\\)\n\n# Write to file to avoid encoding issues\nrd = ex.get\\(''data'', {}\\).get\\(''resultData'', {}\\).get\\(''runData'', {}\\)\nresults = []\nfor node_name, runs in rd.items\\(\\):\n    for run in runs:\n        error = run.get\\(''error''\\)\n        if error:\n            results.append\\(f''ERROR in [{node_name}]: {json.dumps\\(error, ensure_ascii=True\\)[:800]}''\\)\n        else:\n            status = run.get\\(''executionStatus'', ''unknown''\\)\n            results.append\\(f''[{node_name}] status={status}''\\)\n\nwith open\\(''tmp_exec_result.txt'', ''w'', encoding=''utf-8''\\) as f:\n    f.write\\(''\\\\n''.join\\(results\\)\\)\nprint\\(''Written to tmp_exec_result.txt''\\)\n\")",
      "Bash(PYTHONUTF8=1 python -c \"\nimport json, urllib.request, ssl\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\nAPI_KEY = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY''\nN8N = ''https://n8n.creativeanalytic.ru''\n\nreq = urllib.request.Request\\(N8N + ''/api/v1/executions/5322''\\)\nreq.add_header\\(''X-N8N-API-KEY'', API_KEY\\)\nresp = urllib.request.urlopen\\(req, context=ctx\\)\nraw = resp.read\\(\\).decode\\(\\)\n\nex = json.loads\\(raw\\)\nrd = ex.get\\(''data'', {}\\).get\\(''resultData'', {}\\).get\\(''runData'', {}\\)\n\n# Just dump the node names and errors\nout = []\nfor nn in rd:\n    runs = rd[nn]\n    for r in runs:\n        err = r.get\\(''error''\\)\n        if err:\n            out.append\\(''ERROR [%s]: %s'' % \\(nn, json.dumps\\(err, ensure_ascii=True\\)[:600]\\)\\)\n        else:\n            out.append\\(''OK [%s]'' % nn\\)\n\n# Write as ASCII\nwith open\\(''tmp_debug.txt'', ''w'', encoding=''ascii'', errors=''replace''\\) as f:\n    for line in out:\n        f.write\\(line + chr\\(10\\)\\)\n\nprint\\(''done, lines:'', len\\(out\\)\\)\n\")",
      "Bash(PYTHONUTF8=1 python -c \"\nimport json, urllib.request, ssl\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\nAPI_KEY = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY''\nN8N = ''https://n8n.creativeanalytic.ru''\n\nreq = urllib.request.Request\\(N8N + ''/api/v1/executions/5322''\\)\nreq.add_header\\(''X-N8N-API-KEY'', API_KEY\\)\nresp = urllib.request.urlopen\\(req, context=ctx\\)\nraw = resp.read\\(\\).decode\\(\\)\nex = json.loads\\(raw\\)\n\n# Check top-level keys\ntop_keys = list\\(ex.keys\\(\\)\\)\nprint\\(''top keys:'', top_keys\\)\n\ndata = ex.get\\(''data'', {}\\)\nif isinstance\\(data, dict\\):\n    print\\(''data keys:'', list\\(data.keys\\(\\)\\)\\)\n    rd = data.get\\(''resultData'', {}\\)\n    if isinstance\\(rd, dict\\):\n        print\\(''resultData keys:'', list\\(rd.keys\\(\\)\\)\\)\n        run_data = rd.get\\(''runData'', {}\\)\n        print\\(''runData keys:'', list\\(run_data.keys\\(\\)\\) if isinstance\\(run_data, dict\\) else type\\(run_data\\)\\)\n        last_error = rd.get\\(''error'', None\\)\n        if last_error:\n            print\\(''resultData.error:'', json.dumps\\(last_error, ensure_ascii=True\\)[:500]\\)\nelse:\n    print\\(''data type:'', type\\(data\\)\\)\n    print\\(''data[:200]:'', str\\(data\\)[:200]\\)\n\")",
      "Bash(PYTHONUTF8=1 python:*)",
      "WebFetch(domain:membertel.com)",
      "WebFetch(domain:openclaw.im)",
      "WebFetch(domain:lumadock.com)",
      "WebFetch(domain:t.me)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:www.gadgetbridge.com)",
      "WebFetch(domain:www.findmini.app)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\check_param_paths.py\" << 'PYEOF'\nimport requests\nimport json\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY}\n\nWORKFLOWS = {\n    \"Stylize\":        \"3iZY--GtxZ556edSgZQuB\",\n    \"Multi-photo\":    \"FXRCdsL4ULHevtbz\",\n    \"Style-transfer\": \"HbqrBmstlPbz9VxM\",\n    \"Video\":          \"fmTA4l0XfQXTajGI\",\n    \"Face-swap\":      \"qKyOmXDNPNvG9WH9\",\n    \"Remove-bg\":      \"z29Bx9CRXKvcHgvI\",\n    \"Enhance\":        \"Lfra98zYiGA0yKmD\",\n    \"Text-to-image\":  \"QP37jmBYCpeaCzYV\",\n}\n\nSEP = \"=\" * 100\nSUBSEP = \"-\" * 80\n\ndef fetch_workflow\\(wf_id\\):\n    url = f\"{BASE}/api/v1/workflows/{wf_id}\"\n    r = requests.get\\(url, headers=HEADERS, verify=False\\)\n    r.raise_for_status\\(\\)\n    return r.json\\(\\)\n\ndef analyze_workflow\\(name, wf_id\\):\n    print\\(f\"\\\\n{SEP}\"\\)\n    print\\(f\"  WORKFLOW: {name} \\(ID: {wf_id}\\)\"\\)\n    print\\(SEP\\)\n\n    try:\n        data = fetch_workflow\\(wf_id\\)\n    except Exception as e:\n        print\\(f\"  ERROR fetching workflow: {e}\"\\)\n        return\n\n    nodes = data.get\\(\"nodes\", []\\)\n    connections = data.get\\(\"connections\", {}\\)\n\n    # 1. Webhook nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [1] WEBHOOK NODES \\(entry points\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        if \"webhook\" in node.get\\(\"type\", \"\"\\).lower\\(\\) or \"webhook\" in node.get\\(\"name\", \"\"\\).lower\\(\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(f\"  Path: {params.get\\('path', 'N/A'\\)}\"\\)\n            print\\(f\"  HTTP Method: {params.get\\('httpMethod', 'N/A'\\)}\"\\)\n            print\\(f\"  Response Mode: {params.get\\('responseMode', 'N/A'\\)}\"\\)\n            # Show all params\n            for k, v in params.items\\(\\):\n                if k not in \\('path', 'httpMethod', 'responseMode'\\):\n                    print\\(f\"  {k}: {v}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 2. Code nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [2] CODE NODES \\(parameter processing\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        if ntype == \"n8n-nodes-base.code\" or \"code\" in ntype.lower\\(\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            js_code = params.get\\(\"jsCode\", \"\"\\)\n            if js_code:\n                print\\(f\"  jsCode:\"\\)\n                for line in js_code.split\\(\"\\\\n\"\\):\n                    print\\(f\"    {line}\"\\)\n            else:\n                print\\(f\"  \\(no jsCode\\)\"\\)\n                print\\(f\"  All params: {json.dumps\\(params, indent=4, ensure_ascii=False\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 3. HTTP Request nodes with fal.ai\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [3] FAL.AI HTTP REQUEST NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        params = node.get\\(\"parameters\", {}\\)\n        url_val = params.get\\(\"url\", \"\"\\)\n        # Check if fal is in the URL or node name\n        is_fal = \"fal\" in str\\(url_val\\).lower\\(\\) or \"fal\" in node.get\\(\"name\", \"\"\\).lower\\(\\)\n        is_http = \"httpRequest\" in ntype.lower\\(\\) or \"http\" in ntype.lower\\(\\)\n        if is_http and is_fal:\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            print\\(f\"  URL: {url_val}\"\\)\n            print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n            print\\(f\"  Send Body: {params.get\\('sendBody', 'N/A'\\)}\"\\)\n            print\\(f\"  Content Type: {params.get\\('contentType', 'N/A'\\)}\"\\)\n            print\\(f\"  Body Content Type: {params.get\\('bodyContentType', 'N/A'\\)}\"\\)\n\n            # jsonBody / body / specifyBody\n            json_body = params.get\\(\"jsonBody\", \"\"\\)\n            if json_body:\n                print\\(f\"  jsonBody:\"\\)\n                # Try to pretty print if it's JSON\n                try:\n                    parsed = json.loads\\(json_body\\)\n                    for line in json.dumps\\(parsed, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n                except:\n                    for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n\n            # Also check bodyParametersJson, body, options, etc.\n            for key in \\(\"body\", \"bodyParametersJson\", \"bodyParameters\", \"options\", \"headerParameters\", \"sendHeaders\"\\):\n                val = params.get\\(key\\)\n                if val:\n                    print\\(f\"  {key}: {json.dumps\\(val, indent=4, ensure_ascii=False\\) if isinstance\\(val, \\(dict, list\\)\\) else val}\"\\)\n\n            # Show authentication\n            auth = node.get\\(\"credentials\", {}\\)\n            if auth:\n                print\\(f\"  Credentials: {json.dumps\\(auth, indent=4, ensure_ascii=False\\)}\"\\)\n\n    if not found:\n        # Also check ALL HTTP request nodes in case fal is in expressions\n        print\\(\"  \\(no direct fal.ai URL found, checking all HTTP Request nodes...\\)\"\\)\n        for node in nodes:\n            ntype = node.get\\(\"type\", \"\"\\)\n            if \"httpRequest\" in ntype.lower\\(\\) or \"http\" in ntype.lower\\(\\):\n                params = node.get\\(\"parameters\", {}\\)\n                print\\(f\"\\\\n  Node: {node['name']}\"\\)\n                print\\(f\"  Type: {ntype}\"\\)\n                print\\(f\"  URL: {params.get\\('url', 'N/A'\\)}\"\\)\n                print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n                json_body = params.get\\(\"jsonBody\", \"\"\\)\n                if json_body:\n                    print\\(f\"  jsonBody:\"\\)\n                    try:\n                        parsed = json.loads\\(json_body\\)\n                        for line in json.dumps\\(parsed, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                    except:\n                        for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                for key in \\(\"body\", \"bodyParametersJson\", \"sendBody\", \"contentType\", \"bodyContentType\", \"options\"\\):\n                    val = params.get\\(key\\)\n                    if val:\n                        print\\(f\"  {key}: {json.dumps\\(val, indent=4, ensure_ascii=False\\) if isinstance\\(val, \\(dict, list\\)\\) else val}\"\\)\n\n    # 4. Translate / OpenAI / prompt preparation nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [4] TRANSLATE / OPENAI / PROMPT NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        nname = node.get\\(\"name\", \"\"\\).lower\\(\\)\n        ntype = node.get\\(\"type\", \"\"\\).lower\\(\\)\n        if any\\(kw in nname for kw in \\(\"translat\", \"openai\", \"prompt\", \"gpt\", \"chat\"\\)\\) or \\\\\n           any\\(kw in ntype for kw in \\(\"openai\", \"langchain\", \"lmchatopen\"\\)\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(f\"  Parameters:\"\\)\n            for line in json.dumps\\(params, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                print\\(f\"    {line}\"\\)\n            creds = node.get\\(\"credentials\", {}\\)\n            if creds:\n                print\\(f\"  Credentials: {json.dumps\\(creds, indent=4, ensure_ascii=False\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 5. Summary: list all nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [5] ALL NODES SUMMARY\"\\)\n    print\\(SUBSEP\\)\n    for i, node in enumerate\\(nodes\\):\n        print\\(f\"  {i+1:3d}. [{node['type']}] {node['name']}\"\\)\n\n\ndef main\\(\\):\n    print\\(\"AVATAR BOT - WORKFLOW PARAMETER ANALYSIS\"\\)\n    print\\(f\"Fetching {len\\(WORKFLOWS\\)} workflows from {BASE}\"\\)\n    print\\(SEP\\)\n\n    for name, wf_id in WORKFLOWS.items\\(\\):\n        analyze_workflow\\(name, wf_id\\)\n\n    print\\(f\"\\\\n\\\\n{SEP}\"\\)\n    print\\(\"  ANALYSIS COMPLETE\"\\)\n    print\\(SEP\\)\n\nif __name__ == \"__main__\":\n    main\\(\\)\nPYEOF)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\check_param_paths.py\" << 'ENDOFSCRIPT'\nimport requests\nimport json\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY}\n\nWORKFLOWS = {\n    \"Stylize\":        \"3iZY--GtxZ556edSgZQuB\",\n    \"Multi-photo\":    \"FXRCdsL4ULHevtbz\",\n    \"Style-transfer\": \"HbqrBmstlPbz9VxM\",\n    \"Video\":          \"fmTA4l0XfQXTajGI\",\n    \"Face-swap\":      \"qKyOmXDNPNvG9WH9\",\n    \"Remove-bg\":      \"z29Bx9CRXKvcHgvI\",\n    \"Enhance\":        \"Lfra98zYiGA0yKmD\",\n    \"Text-to-image\":  \"QP37jmBYCpeaCzYV\",\n}\n\nSEP = \"=\" * 100\nSUBSEP = \"-\" * 80\n\ndef fetch_workflow\\(wf_id\\):\n    url = f\"{BASE}/api/v1/workflows/{wf_id}\"\n    r = requests.get\\(url, headers=HEADERS, verify=False\\)\n    r.raise_for_status\\(\\)\n    return r.json\\(\\)\n\ndef analyze_workflow\\(name, wf_id\\):\n    print\\(f\"\\\\n{SEP}\"\\)\n    print\\(f\"  WORKFLOW: {name} \\(ID: {wf_id}\\)\"\\)\n    print\\(SEP\\)\n\n    try:\n        data = fetch_workflow\\(wf_id\\)\n    except Exception as e:\n        print\\(f\"  ERROR fetching workflow: {e}\"\\)\n        return\n\n    nodes = data.get\\(\"nodes\", []\\)\n\n    # 1. Webhook nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [1] WEBHOOK NODES \\(entry points\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        if \"webhook\" in node.get\\(\"type\", \"\"\\).lower\\(\\) or \"webhook\" in node.get\\(\"name\", \"\"\\).lower\\(\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(f\"  Path: {params.get\\('path', 'N/A'\\)}\"\\)\n            print\\(f\"  HTTP Method: {params.get\\('httpMethod', 'N/A'\\)}\"\\)\n            print\\(f\"  Response Mode: {params.get\\('responseMode', 'N/A'\\)}\"\\)\n            for k, v in params.items\\(\\):\n                if k not in \\('path', 'httpMethod', 'responseMode'\\):\n                    print\\(f\"  {k}: {v}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 2. Code nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [2] CODE NODES \\(parameter processing\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        if ntype == \"n8n-nodes-base.code\" or \"code\" == ntype.split\\(\".\"\\)[-1]:\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            js_code = params.get\\(\"jsCode\", \"\"\\)\n            if js_code:\n                print\\(f\"  jsCode:\"\\)\n                for line in js_code.split\\(\"\\\\n\"\\):\n                    print\\(f\"    {line}\"\\)\n            else:\n                print\\(f\"  \\(no jsCode found\\)\"\\)\n                print\\(f\"  All params: {json.dumps\\(params, indent=4, ensure_ascii=False\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 3. HTTP Request nodes with fal.ai\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [3] FAL.AI HTTP REQUEST NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        params = node.get\\(\"parameters\", {}\\)\n        url_val = str\\(params.get\\(\"url\", \"\"\\)\\)\n        is_fal = \"fal\" in url_val.lower\\(\\) or \"fal\" in node.get\\(\"name\", \"\"\\).lower\\(\\)\n        is_http = \"httprequest\" in ntype.lower\\(\\).replace\\(\".\", \"\"\\) or ntype == \"n8n-nodes-base.httpRequest\"\n        if is_http and is_fal:\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            print\\(f\"  URL: {url_val}\"\\)\n            print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n            print\\(f\"  Send Body: {params.get\\('sendBody', 'N/A'\\)}\"\\)\n            print\\(f\"  Content Type: {params.get\\('contentType', 'N/A'\\)}\"\\)\n            print\\(f\"  Body Content Type: {params.get\\('bodyContentType', 'N/A'\\)}\"\\)\n\n            json_body = params.get\\(\"jsonBody\", \"\"\\)\n            if json_body:\n                print\\(f\"  jsonBody:\"\\)\n                try:\n                    parsed = json.loads\\(json_body\\)\n                    for line in json.dumps\\(parsed, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n                except:\n                    for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n\n            for key in \\(\"body\", \"bodyParametersJson\", \"bodyParameters\", \"options\", \"headerParameters\", \"sendHeaders\"\\):\n                val = params.get\\(key\\)\n                if val:\n                    dumped = json.dumps\\(val, indent=4, ensure_ascii=False\\) if isinstance\\(val, \\(dict, list\\)\\) else str\\(val\\)\n                    print\\(f\"  {key}: {dumped}\"\\)\n\n            auth = node.get\\(\"credentials\", {}\\)\n            if auth:\n                print\\(f\"  Credentials: {json.dumps\\(auth, indent=4, ensure_ascii=False\\)}\"\\)\n\n    if not found:\n        print\\(\"  \\(no direct fal.ai URL found, listing all HTTP Request nodes...\\)\"\\)\n        for node in nodes:\n            ntype = node.get\\(\"type\", \"\"\\)\n            if ntype == \"n8n-nodes-base.httpRequest\":\n                params = node.get\\(\"parameters\", {}\\)\n                print\\(f\"\\\\n  Node: {node['name']}\"\\)\n                print\\(f\"  Type: {ntype}\"\\)\n                print\\(f\"  URL: {params.get\\('url', 'N/A'\\)}\"\\)\n                print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n                json_body = params.get\\(\"jsonBody\", \"\"\\)\n                if json_body:\n                    print\\(f\"  jsonBody:\"\\)\n                    try:\n                        parsed = json.loads\\(json_body\\)\n                        for line in json.dumps\\(parsed, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                    except:\n                        for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                for key in \\(\"sendBody\", \"contentType\", \"bodyContentType\", \"body\", \"bodyParametersJson\", \"options\"\\):\n                    val = params.get\\(key\\)\n                    if val:\n                        dumped = json.dumps\\(val, indent=4, ensure_ascii=False\\) if isinstance\\(val, \\(dict, list\\)\\) else str\\(val\\)\n                        print\\(f\"  {key}: {dumped}\"\\)\n\n    # 4. Translate / OpenAI / prompt preparation nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [4] TRANSLATE / OPENAI / PROMPT NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        nname = node.get\\(\"name\", \"\"\\).lower\\(\\)\n        ntype = node.get\\(\"type\", \"\"\\).lower\\(\\)\n        if any\\(kw in nname for kw in \\(\"translat\", \"openai\", \"prompt\", \"gpt\", \"chat\"\\)\\) or \\\\\n           any\\(kw in ntype for kw in \\(\"openai\", \"langchain\", \"lmchatopen\"\\)\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(f\"  Parameters:\"\\)\n            for line in json.dumps\\(params, indent=4, ensure_ascii=False\\).split\\(\"\\\\n\"\\):\n                print\\(f\"    {line}\"\\)\n            creds = node.get\\(\"credentials\", {}\\)\n            if creds:\n                print\\(f\"  Credentials: {json.dumps\\(creds, indent=4, ensure_ascii=False\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 5. All nodes summary\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [5] ALL NODES SUMMARY\"\\)\n    print\\(SUBSEP\\)\n    for i, node in enumerate\\(nodes\\):\n        print\\(f\"  {i+1:3d}. [{node['type']}] {node['name']}\"\\)\n\n\ndef main\\(\\):\n    print\\(\"AVATAR BOT - WORKFLOW PARAMETER ANALYSIS\"\\)\n    print\\(f\"Fetching {len\\(WORKFLOWS\\)} workflows from {BASE}\"\\)\n    print\\(SEP\\)\n\n    for name, wf_id in WORKFLOWS.items\\(\\):\n        analyze_workflow\\(name, wf_id\\)\n\n    print\\(f\"\\\\n\\\\n{SEP}\"\\)\n    print\\(\"  ANALYSIS COMPLETE\"\\)\n    print\\(SEP\\)\n\nif __name__ == \"__main__\":\n    main\\(\\)\nENDOFSCRIPT)",
      "Bash(powershell -Command \"\n[IO.File]::WriteAllText\\(''c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\gen_script.py'', @''\nimport base64, sys\n\nSCRIPT = \"\"\"\"\"\"\nimport requests\nimport json\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"\"https://n8n.creativeanalytic.ru\"\"\nAPI_KEY = \"\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\"\nHEADERS = {\"\"X-N8N-API-KEY\"\": API_KEY}\n\nWORKFLOWS = {\n    \"\"Stylize\"\":        \"\"3iZY--GtxZ556edSgZQuB\"\",\n    \"\"Multi-photo\"\":    \"\"FXRCdsL4ULHevtbz\"\",\n    \"\"Style-transfer\"\": \"\"HbqrBmstlPbz9VxM\"\",\n    \"\"Video\"\":          \"\"fmTA4l0XfQXTajGI\"\",\n    \"\"Face-swap\"\":      \"\"qKyOmXDNPNvG9WH9\"\",\n    \"\"Remove-bg\"\":      \"\"z29Bx9CRXKvcHgvI\"\",\n    \"\"Enhance\"\":        \"\"Lfra98zYiGA0yKmD\"\",\n    \"\"Text-to-image\"\":  \"\"QP37jmBYCpeaCzYV\"\",\n}\n\"\"\"\"\"\"\n\nprint\\(SCRIPT\\)\n''@\\)\nWrite-Output ''gen_script written''\n\")",
      "Bash(powershell -NoProfile -ExecutionPolicy Bypass -File - << 'PS_END'\n$scriptContent = @\"\nimport requests\nimport json\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY}\n\nWORKFLOWS = {\n    \"Stylize\":        \"3iZY--GtxZ556edSgZQuB\",\n    \"Multi-photo\":    \"FXRCdsL4ULHevtbz\",\n    \"Style-transfer\": \"HbqrBmstlPbz9VxM\",\n    \"Video\":          \"fmTA4l0XfQXTajGI\",\n    \"Face-swap\":      \"qKyOmXDNPNvG9WH9\",\n    \"Remove-bg\":      \"z29Bx9CRXKvcHgvI\",\n    \"Enhance\":        \"Lfra98zYiGA0yKmD\",\n    \"Text-to-image\":  \"QP37jmBYCpeaCzYV\",\n}\n\nSEP = \"=\" * 100\nSUBSEP = \"-\" * 80\n\n\ndef fetch_workflow\\(wf_id\\):\n    url = f\"{BASE}/api/v1/workflows/{wf_id}\"\n    r = requests.get\\(url, headers=HEADERS, verify=False\\)\n    r.raise_for_status\\(\\)\n    return r.json\\(\\)\n\n\ndef pj\\(obj\\):\n    return json.dumps\\(obj, indent=4, ensure_ascii=False\\)\n\n\ndef analyze_workflow\\(name, wf_id\\):\n    print\\(f\"\\\\n{SEP}\"\\)\n    print\\(f\"  WORKFLOW: {name} \\(ID: {wf_id}\\)\"\\)\n    print\\(SEP\\)\n    try:\n        data = fetch_workflow\\(wf_id\\)\n    except Exception as e:\n        print\\(f\"  ERROR fetching workflow: {e}\"\\)\n        return\n\n    nodes = data.get\\(\"nodes\", []\\)\n\n    # 1. Webhook nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [1] WEBHOOK NODES \\(entry points\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        if \"webhook\" in node.get\\(\"type\", \"\"\\).lower\\(\\) or \"webhook\" in node.get\\(\"name\", \"\"\\).lower\\(\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(f\"  Path: {params.get\\('path', 'N/A'\\)}\"\\)\n            print\\(f\"  HTTP Method: {params.get\\('httpMethod', 'N/A'\\)}\"\\)\n            print\\(f\"  Response Mode: {params.get\\('responseMode', 'N/A'\\)}\"\\)\n            for k, v in params.items\\(\\):\n                if k not in \\(\"path\", \"httpMethod\", \"responseMode\"\\):\n                    print\\(f\"  {k}: {v}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 2. Code nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [2] CODE NODES \\(parameter processing\\)\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        if ntype == \"n8n-nodes-base.code\":\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            js_code = params.get\\(\"jsCode\", \"\"\\)\n            if js_code:\n                print\\(\"  jsCode:\"\\)\n                for line in js_code.split\\(\"\\\\n\"\\):\n                    print\\(f\"    {line}\"\\)\n            else:\n                print\\(\"  \\(no jsCode found\\)\"\\)\n                print\\(f\"  All params: {pj\\(params\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 3. HTTP Request nodes with fal.ai\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [3] FAL.AI HTTP REQUEST NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        ntype = node.get\\(\"type\", \"\"\\)\n        params = node.get\\(\"parameters\", {}\\)\n        url_val = str\\(params.get\\(\"url\", \"\"\\)\\)\n        is_fal = \"fal\" in url_val.lower\\(\\) or \"fal\" in node.get\\(\"name\", \"\"\\).lower\\(\\)\n        is_http = ntype == \"n8n-nodes-base.httpRequest\"\n        if is_http and is_fal:\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {ntype}\"\\)\n            print\\(f\"  URL: {url_val}\"\\)\n            print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n            print\\(f\"  Send Body: {params.get\\('sendBody', 'N/A'\\)}\"\\)\n            print\\(f\"  Content Type: {params.get\\('contentType', 'N/A'\\)}\"\\)\n            print\\(f\"  Body Content Type: {params.get\\('bodyContentType', 'N/A'\\)}\"\\)\n            json_body = params.get\\(\"jsonBody\", \"\"\\)\n            if json_body:\n                print\\(\"  jsonBody:\"\\)\n                try:\n                    parsed = json.loads\\(json_body\\)\n                    for line in pj\\(parsed\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n                except Exception:\n                    for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                        print\\(f\"    {line}\"\\)\n            for key in \\(\"body\", \"bodyParametersJson\", \"bodyParameters\", \"options\", \"headerParameters\", \"sendHeaders\"\\):\n                val = params.get\\(key\\)\n                if val:\n                    dumped = pj\\(val\\) if isinstance\\(val, \\(dict, list\\)\\) else str\\(val\\)\n                    print\\(f\"  {key}: {dumped}\"\\)\n            auth = node.get\\(\"credentials\", {}\\)\n            if auth:\n                print\\(f\"  Credentials: {pj\\(auth\\)}\"\\)\n    if not found:\n        print\\(\"  \\(no direct fal.ai URL found, listing all HTTP Request nodes...\\)\"\\)\n        for node in nodes:\n            ntype = node.get\\(\"type\", \"\"\\)\n            if ntype == \"n8n-nodes-base.httpRequest\":\n                params = node.get\\(\"parameters\", {}\\)\n                print\\(f\"\\\\n  Node: {node['name']}\"\\)\n                print\\(f\"  URL: {params.get\\('url', 'N/A'\\)}\"\\)\n                print\\(f\"  Method: {params.get\\('method', 'N/A'\\)}\"\\)\n                json_body = params.get\\(\"jsonBody\", \"\"\\)\n                if json_body:\n                    print\\(\"  jsonBody:\"\\)\n                    try:\n                        parsed = json.loads\\(json_body\\)\n                        for line in pj\\(parsed\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                    except Exception:\n                        for line in str\\(json_body\\).split\\(\"\\\\n\"\\):\n                            print\\(f\"    {line}\"\\)\n                for key in \\(\"sendBody\", \"contentType\", \"bodyContentType\", \"options\"\\):\n                    val = params.get\\(key\\)\n                    if val:\n                        dumped = pj\\(val\\) if isinstance\\(val, \\(dict, list\\)\\) else str\\(val\\)\n                        print\\(f\"  {key}: {dumped}\"\\)\n\n    # 4. Translate / OpenAI / prompt preparation nodes\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [4] TRANSLATE / OPENAI / PROMPT NODES\"\\)\n    print\\(SUBSEP\\)\n    found = False\n    for node in nodes:\n        nname = node.get\\(\"name\", \"\"\\).lower\\(\\)\n        ntype = node.get\\(\"type\", \"\"\\).lower\\(\\)\n        kw_name = [\"translat\", \"openai\", \"prompt\", \"gpt\", \"chat\"]\n        kw_type = [\"openai\", \"langchain\", \"lmchatopen\"]\n        if any\\(kw in nname for kw in kw_name\\) or any\\(kw in ntype for kw in kw_type\\):\n            found = True\n            print\\(f\"\\\\n  Node: {node['name']}\"\\)\n            print\\(f\"  Type: {node['type']}\"\\)\n            params = node.get\\(\"parameters\", {}\\)\n            print\\(\"  Parameters:\"\\)\n            for line in pj\\(params\\).split\\(\"\\\\n\"\\):\n                print\\(f\"    {line}\"\\)\n            creds = node.get\\(\"credentials\", {}\\)\n            if creds:\n                print\\(f\"  Credentials: {pj\\(creds\\)}\"\\)\n    if not found:\n        print\\(\"  \\(none found\\)\"\\)\n\n    # 5. All nodes summary\n    print\\(f\"\\\\n{SUBSEP}\"\\)\n    print\\(\"  [5] ALL NODES SUMMARY\"\\)\n    print\\(SUBSEP\\)\n    for i, node in enumerate\\(nodes\\):\n        print\\(f\"  {i+1:3d}. [{node['type']}] {node['name']}\"\\)\n\n\ndef main\\(\\):\n    print\\(\"AVATAR BOT - WORKFLOW PARAMETER ANALYSIS\"\\)\n    print\\(f\"Fetching {len\\(WORKFLOWS\\)} workflows from {BASE}\"\\)\n    print\\(SEP\\)\n    for name, wf_id in WORKFLOWS.items\\(\\):\n        analyze_workflow\\(name, wf_id\\)\n    print\\(f\"\\\\n\\\\n{SEP}\"\\)\n    print\\(\"  ANALYSIS COMPLETE\"\\)\n    print\\(SEP\\)\n\n\nif __name__ == \"__main__\":\n    main\\(\\)\n\"@\n\n[System.IO.File]::WriteAllText\\(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\check_param_paths.py\", $scriptContent, [System.Text.Encoding]::UTF8\\)\nWrite-Output \"Script written successfully!\"\nPS_END)",
      "Bash(set:*)",
      "Bash(PYTHONIOENCODING=utf-8 python:*)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\fix_stylize_prompt.py\" << 'PYEOF'\nimport requests\nimport json\nimport urllib3\n\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nWF_ID = \"3iZY--GtxZ556edSgZQuB\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY, \"Content-Type\": \"application/json\"}\n\nOLD_PROMPT_SUFFIX = ' style portrait, high quality, detailed, vibrant colors'\n\n# Step 1: Deactivate workflow\nprint\\(\"=\" * 60\\)\nprint\\(\"STEP 1: Deactivating workflow...\"\\)\nr = requests.patch\\(f\"{BASE}/api/v1/workflows/{WF_ID}\", headers=HEADERS, json={\"active\": False}, verify=False\\)\nprint\\(f\"  Status: {r.status_code}\"\\)\nif r.status_code == 200:\n    print\\(f\"  Active: {r.json\\(\\).get\\('active'\\)}\"\\)\nelse:\n    print\\(f\"  Response: {r.text[:300]}\"\\)\n\n# Step 2: GET workflow\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"STEP 2: Fetching workflow...\"\\)\nr = requests.get\\(f\"{BASE}/api/v1/workflows/{WF_ID}\", headers=HEADERS, verify=False\\)\nprint\\(f\"  Status: {r.status_code}\"\\)\nwf = r.json\\(\\)\nprint\\(f\"  Workflow name: {wf.get\\('name'\\)}\"\\)\nprint\\(f\"  Total nodes: {len\\(wf.get\\('nodes', []\\)\\)}\"\\)\n\n# Step 3 & 4: Find all HTTP Request nodes with fal in URL, fix prompt\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"STEP 3-4: Finding and fixing HTTP Request nodes with fal.ai...\"\\)\nnodes = wf.get\\(\"nodes\", []\\)\nfixed_count = 0\n\nfor node in nodes:\n    if node.get\\(\"type\"\\) != \"n8n-nodes-base.httpRequest\":\n        continue\n\n    params = node.get\\(\"parameters\", {}\\)\n    url = params.get\\(\"url\", \"\"\\)\n\n    if \"fal\" not in url.lower\\(\\):\n        continue\n\n    print\\(f\"\\\\n  Found node: '{node['name']}' \\(url: {url}\\)\"\\)\n\n    body = params.get\\(\"body\", \"\"\\) or \"\"\n    json_body = params.get\\(\"jsonBody\", \"\"\\) or \"\"\n\n    # Check both body and jsonBody fields\n    target_field = None\n    target_value = None\n\n    if json_body and OLD_PROMPT_SUFFIX in json_body:\n        target_field = \"jsonBody\"\n        target_value = json_body\n    elif body and OLD_PROMPT_SUFFIX in body:\n        target_field = \"body\"\n        target_value = body\n    elif json_body and \"style\" in json_body:\n        target_field = \"jsonBody\"\n        target_value = json_body\n    elif body and \"style\" in body:\n        target_field = \"body\"\n        target_value = body\n\n    if not target_field:\n        # Also check sendBody / specifyBody options\n        opts = params.get\\(\"options\", {}\\)\n        for key in [\"jsonBody\", \"body\"]:\n            val = opts.get\\(key, \"\"\\)\n            if val and \"style\" in val:\n                target_field = f\"options.{key}\"\n                target_value = val\n                break\n\n    if not target_field:\n        print\\(f\"    No matching body field found. Params keys: {list\\(params.keys\\(\\)\\)}\"\\)\n        # Dump full params for debugging\n        print\\(f\"    Full params: {json.dumps\\(params, indent=2, ensure_ascii=False\\)[:1000]}\"\\)\n        continue\n\n    print\\(f\"\\\\n    --- OLD {target_field} ---\"\\)\n    print\\(f\"    {target_value}\"\\)\n\n    # Parse JSON body and fix the prompt\n    try:\n        body_obj = json.loads\\(target_value\\)\n    except json.JSONDecodeError:\n        # It might be a template string with expressions, handle as raw string\n        print\\(f\"    \\(Not valid JSON, treating as raw string\\)\"\\)\n        # Simple string replacement\n        old_pattern = \"{{ $\\('Extract Input Data'\\).first\\(\\).json.style }} style portrait, high quality, detailed, vibrant colors\"\n        new_pattern = \"{{ $\\('Extract Input Data'\\).first\\(\\).json.style }}\"\n        if old_pattern in target_value:\n            new_value = target_value.replace\\(old_pattern, new_pattern\\)\n        else:\n            # Try broader replacement\n            import re\n            new_value = re.sub\\(\n                r\"\\(\\\\{\\\\{.*?\\\\.style\\\\s*\\\\}\\\\}\\)\\\\s*style portrait.*?vibrant colors\",\n                r\"\\\\1\",\n                target_value\n            \\)\n\n        if \".\" in target_field:\n            parts = target_field.split\\(\".\"\\)\n            params[parts[0]][parts[1]] = new_value\n        else:\n            params[target_field] = new_value\n\n        print\\(f\"\\\\n    --- NEW {target_field} ---\"\\)\n        print\\(f\"    {new_value}\"\\)\n        fixed_count += 1\n        continue\n\n    # If valid JSON, fix the prompt field\n    if \"prompt\" in body_obj:\n        old_prompt = body_obj[\"prompt\"]\n        print\\(f\"    Old prompt value: {old_prompt}\"\\)\n\n        old_pattern = \"{{ $\\('Extract Input Data'\\).first\\(\\).json.style }} style portrait, high quality, detailed, vibrant colors\"\n        new_pattern = \"{{ $\\('Extract Input Data'\\).first\\(\\).json.style }}\"\n\n        if old_pattern in old_prompt:\n            body_obj[\"prompt\"] = old_prompt.replace\\(old_pattern, new_pattern\\)\n        elif OLD_PROMPT_SUFFIX in old_prompt:\n            body_obj[\"prompt\"] = old_prompt.replace\\(OLD_PROMPT_SUFFIX, \"\"\\)\n        else:\n            # Regex approach\n            import re\n            body_obj[\"prompt\"] = re.sub\\(\n                r\"\\(\\\\{\\\\{.*?\\\\.style\\\\s*\\\\}\\\\}\\)\\\\s*style portrait.*?vibrant colors\",\n                r\"\\\\1\",\n                old_prompt\n            \\)\n\n        print\\(f\"    New prompt value: {body_obj['prompt']}\"\\)\n\n        new_value = json.dumps\\(body_obj, indent=2, ensure_ascii=False\\)\n        if \".\" in target_field:\n            parts = target_field.split\\(\".\"\\)\n            params[parts[0]][parts[1]] = new_value\n        else:\n            params[target_field] = new_value\n\n        print\\(f\"\\\\n    --- NEW {target_field} ---\"\\)\n        print\\(f\"    {new_value}\"\\)\n        fixed_count += 1\n    else:\n        print\\(f\"    No 'prompt' key in parsed JSON. Keys: {list\\(body_obj.keys\\(\\)\\)}\"\\)\n\nprint\\(f\"\\\\n  Total nodes fixed: {fixed_count}\"\\)\n\n# Step 6: PUT/save the workflow\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"STEP 6: Saving workflow...\"\\)\n\n# Build the payload - include nodes and connections\npayload = {\n    \"nodes\": wf[\"nodes\"],\n    \"connections\": wf[\"connections\"],\n    \"settings\": wf.get\\(\"settings\", {}\\),\n    \"name\": wf[\"name\"],\n}\n\nr = requests.put\\(f\"{BASE}/api/v1/workflows/{WF_ID}\", headers=HEADERS, json=payload, verify=False\\)\nprint\\(f\"  Status: {r.status_code}\"\\)\nif r.status_code != 200:\n    print\\(f\"  Response: {r.text[:500]}\"\\)\nelse:\n    print\\(\"  Workflow saved successfully!\"\\)\n\n# Step 7: Activate workflow\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"STEP 7: Activating workflow...\"\\)\nr = requests.patch\\(f\"{BASE}/api/v1/workflows/{WF_ID}\", headers=HEADERS, json={\"active\": True}, verify=False\\)\nprint\\(f\"  Status: {r.status_code}\"\\)\nif r.status_code == 200:\n    print\\(f\"  Active: {r.json\\(\\).get\\('active'\\)}\"\\)\nelse:\n    print\\(f\"  Response: {r.text[:300]}\"\\)\n\n# Step 8: Verify\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"STEP 8: Verification - re-fetching workflow...\"\\)\nr = requests.get\\(f\"{BASE}/api/v1/workflows/{WF_ID}\", headers=HEADERS, verify=False\\)\nwf2 = r.json\\(\\)\nprint\\(f\"  Status: {r.status_code}\"\\)\nprint\\(f\"  Active: {wf2.get\\('active'\\)}\"\\)\n\nfor node in wf2.get\\(\"nodes\", []\\):\n    if node.get\\(\"type\"\\) != \"n8n-nodes-base.httpRequest\":\n        continue\n    params = node.get\\(\"parameters\", {}\\)\n    url = params.get\\(\"url\", \"\"\\)\n    if \"fal\" not in url.lower\\(\\):\n        continue\n\n    print\\(f\"\\\\n  Node: '{node['name']}'\"\\)\n    for field in [\"jsonBody\", \"body\"]:\n        val = params.get\\(field, \"\"\\)\n        if val and \"style\" in val:\n            print\\(f\"    {field}:\"\\)\n            print\\(f\"    {val}\"\\)\n\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"DONE!\"\\)\nPYEOF)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\check_topics_existing_users.py\" << 'PYEOF'\nimport requests\nimport json\nimport urllib3\n\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE_URL = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY, \"Content-Type\": \"application/json\"}\n\nSEPARATOR = \"=\" * 70\n\ndef fetch_workflow\\(wf_id, label=None\\):\n    url = f\"{BASE_URL}/api/v1/workflows/{wf_id}\"\n    r = requests.get\\(url, headers=HEADERS, verify=False\\)\n    r.raise_for_status\\(\\)\n    data = r.json\\(\\)\n    if label:\n        print\\(f\"  Fetched workflow: {data.get\\('name', '?'\\)} \\(ID: {wf_id}\\)\"\\)\n    return data\n\ndef get_node_names\\(wf\\):\n    return {n[\"name\"]: n for n in wf.get\\(\"nodes\", []\\)}\n\ndef get_connections\\(wf\\):\n    \"\"\"Return a dict: source_node -> list of target_node names\"\"\"\n    conns = wf.get\\(\"connections\", {}\\)\n    result = {}\n    for src, outputs in conns.items\\(\\):\n        targets = []\n        if isinstance\\(outputs, dict\\):\n            for key, branches in outputs.items\\(\\):\n                for branch in branches:\n                    for link in branch:\n                        targets.append\\(link.get\\(\"node\", \"?\"\\)\\)\n        result[src] = targets\n    return result\n\ndef check_connection_chain\\(conns, chain\\):\n    \"\"\"Check that A -> B -> C -> ... exists in connections\"\"\"\n    ok = True\n    for i in range\\(len\\(chain\\) - 1\\):\n        src = chain[i]\n        dst = chain[i + 1]\n        targets = conns.get\\(src, []\\)\n        if dst in targets:\n            print\\(f\"    [OK] {src} -> {dst}\"\\)\n        else:\n            print\\(f\"    [MISSING] {src} -> {dst}  \\(actual targets: {targets}\\)\"\\)\n            ok = False\n    return ok\n\n\n# ============================================================\n# PART 1: Check bot-start-handler\n# ============================================================\nprint\\(SEPARATOR\\)\nprint\\(\"PART 1: BOT-START-HANDLER WORKFLOW \\(G52H2goZzpFSLUSa\\)\"\\)\nprint\\(SEPARATOR\\)\n\nwf_start = fetch_workflow\\(\"G52H2goZzpFSLUSa\", label=\"bot-start-handler\"\\)\nnodes_start = get_node_names\\(wf_start\\)\nconns_start = get_connections\\(wf_start\\)\n\n# Check topic-related nodes\ntopic_nodes_expected = [\"Get Existing Topics\", \"Create All Topics\", \"Save New Topics\"]\nprint\\(\"\\\\n  Checking for topic creation nodes:\"\\)\nfor name in topic_nodes_expected:\n    if name in nodes_start:\n        node = nodes_start[name]\n        print\\(f\"    [OK] '{name}' exists \\(type: {node.get\\('type', '?'\\)}\\)\"\\)\n    else:\n        # Try partial match\n        matches = [n for n in nodes_start if name.lower\\(\\) in n.lower\\(\\)]\n        if matches:\n            print\\(f\"    [PARTIAL] '{name}' not found exactly, but similar: {matches}\"\\)\n        else:\n            print\\(f\"    [MISSING] '{name}' not found\"\\)\n\n# Check connection chain\nprint\\(\"\\\\n  Checking connection chain \\(Send Photo -> Get Existing Topics -> Create All Topics -> Save New Topics\\):\"\\)\n\n# Find the Send Photo node \\(could have various names\\)\nsend_photo_candidates = [n for n in nodes_start if \"send photo\" in n.lower\\(\\) or \"send image\" in n.lower\\(\\) or \"photo\" in n.lower\\(\\)]\nprint\\(f\"    Send Photo candidates: {send_photo_candidates}\"\\)\n\nchain = [\"Send Photo\"] + topic_nodes_expected\n# Try with exact names first; if Send Photo doesn't exist, try candidates\nif \"Send Photo\" not in nodes_start and send_photo_candidates:\n    chain[0] = send_photo_candidates[0]\n\ncheck_connection_chain\\(conns_start, chain\\)\n\n# List all node names for reference\nprint\\(f\"\\\\n  All nodes in bot-start-handler \\({len\\(nodes_start\\)}\\):\"\\)\nfor name in sorted\\(nodes_start.keys\\(\\)\\):\n    node = nodes_start[name]\n    print\\(f\"    - {name} \\({node.get\\('type', '?'\\)}\\)\"\\)\n\n# Show all connections for reference\nprint\\(f\"\\\\n  All connections:\"\\)\nfor src, targets in sorted\\(conns_start.items\\(\\)\\):\n    for t in targets:\n        print\\(f\"    {src} -> {t}\"\\)\n\n\n# ============================================================\n# PART 2: Check generation workflows for lazy topic fallback\n# ============================================================\nprint\\(\"\\\\n\" + SEPARATOR\\)\nprint\\(\"PART 2: GENERATION WORKFLOWS - LAZY TOPIC CREATION FALLBACK\"\\)\nprint\\(SEPARATOR\\)\n\ngen_workflows = {\n    \"stylize\": \"3iZY--GtxZ556edSgZQuB\",\n    \"enhance\": \"Lfra98zYiGA0yKmD\",\n}\n\nlazy_topic_nodes = [\"Get User Topic\", \"Need Topic?\", \"Create Topic\", \"Save Topic\"]\n\nfor label, wf_id in gen_workflows.items\\(\\):\n    print\\(f\"\\\\n  --- {label.upper\\(\\)} workflow \\({wf_id}\\) ---\"\\)\n    try:\n        wf = fetch_workflow\\(wf_id, label=label\\)\n        nodes = get_node_names\\(wf\\)\n        conns = get_connections\\(wf\\)\n\n        print\\(f\"  Checking lazy topic creation nodes:\"\\)\n        found_all = True\n        for name in lazy_topic_nodes:\n            if name in nodes:\n                node = nodes[name]\n                print\\(f\"    [OK] '{name}' exists \\(type: {node.get\\('type', '?'\\)}\\)\"\\)\n            else:\n                matches = [n for n in nodes if name.lower\\(\\) in n.lower\\(\\)]\n                if matches:\n                    print\\(f\"    [PARTIAL] '{name}' not found exactly, similar: {matches}\"\\)\n                else:\n                    print\\(f\"    [MISSING] '{name}' not found\"\\)\n                    found_all = False\n\n        # Check the lazy chain\n        print\\(f\"  Checking lazy chain \\(Get User Topic -> Need Topic? -> Create Topic -> Save Topic\\):\"\\)\n        check_connection_chain\\(conns, lazy_topic_nodes\\)\n\n    except Exception as e:\n        print\\(f\"    [ERROR] Failed to fetch workflow: {e}\"\\)\n\n\n# ============================================================\n# PART 3: SUMMARY\n# ============================================================\nprint\\(\"\\\\n\" + SEPARATOR\\)\nprint\\(\"PART 3: SUMMARY - EXISTING USERS COVERAGE\"\\)\nprint\\(SEPARATOR\\)\n\nprint\\(\"\"\"\n  QUESTION: Are existing users covered for topic creation?\n\n  ANALYSIS:\n  1. The bot-start-handler workflow now creates all 8 topics when a user\n     presses /start. But existing users who already pressed /start before\n     this change will NOT automatically get their topics -- they would\n     need to press /start again.\n\n  2. HOWEVER, each generation workflow \\(stylize, enhance, etc.\\) has a\n     LAZY TOPIC CREATION FALLBACK:\n       Get User Topic -> Need Topic? -> Create Topic -> Save Topic\n     This means: when an existing user triggers any generation, the\n     workflow first checks if the required topic exists. If not, it\n     creates it on the fly and saves it.\n\n  CONCLUSION:\n  Existing users ARE covered by the lazy fallback mechanism. They do NOT\n  need a separate migration script. Here is how it works:\n\n  - NEW USERS: Press /start -> bot-start-handler creates all 8 topics\n    at once. Fast, everything ready from the start.\n\n  - EXISTING USERS \\(without topics\\): When they use any generation\n    feature, the lazy fallback in that workflow detects the missing\n    topic, creates it, and saves it. Topics are created on-demand, one\n    at a time as the user uses different features.\n\n  NO MIGRATION NEEDED. The dual approach \\(eager on /start + lazy per\n  generation\\) ensures all users are covered.\n\"\"\"\\)\n\nprint\\(SEPARATOR\\)\nprint\\(\"Done.\"\\)\nPYEOF)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\fix_topics_empty_sql.py\" << 'PYEOF'\nimport requests\nimport json\nimport urllib3\n\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nWF_ID = \"G52H2goZzpFSLUSa\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY, \"Content-Type\": \"application/json\"}\nVERIFY = False\n\ndef api\\(method, path, json_data=None\\):\n    url = f\"{BASE}/api/v1{path}\"\n    r = requests.request\\(method, url, headers=HEADERS, json=json_data, verify=VERIFY\\)\n    r.raise_for_status\\(\\)\n    return r.json\\(\\)\n\n# 1. Deactivate workflow\nprint\\(\"=\" * 60\\)\nprint\\(\"Step 1: Deactivating workflow...\"\\)\nresult = api\\(\"POST\", f\"/workflows/{WF_ID}/deactivate\"\\)\nprint\\(f\"  Active: {result.get\\('active'\\)}\"\\)\n\n# 2. GET workflow\nprint\\(\"\\\\nStep 2: Fetching workflow...\"\\)\nwf = api\\(\"GET\", f\"/workflows/{WF_ID}\"\\)\nprint\\(f\"  Workflow: {wf['name']} \\(ID: {wf['id']}\\)\"\\)\nprint\\(f\"  Nodes count: {len\\(wf['nodes']\\)}\"\\)\n\n# 3. Find the \"Create All Topics\" node\nprint\\(\"\\\\nStep 3: Looking for 'Create All Topics' Code node...\"\\)\ntarget_node = None\ntarget_idx = None\nfor i, node in enumerate\\(wf['nodes']\\):\n    if node['name'] == 'Create All Topics' and node['type'] == 'n8n-nodes-base.code':\n        target_node = node\n        target_idx = i\n        break\n\nif target_node is None:\n    print\\(\"  ERROR: 'Create All Topics' node not found!\"\\)\n    exit\\(1\\)\n\nprint\\(f\"  Found node at index {target_idx}: {target_node['name']} \\(type: {target_node['type']}\\)\"\\)\n\n# 4. Replace in jsCode\nprint\\(\"\\\\nStep 4: Replacing `let sql = '';` with `let sql = 'SELECT 1';`...\"\\)\nold_code = target_node['parameters']['jsCode']\n\nOLD_PATTERN = \"let sql = '';\"\nNEW_PATTERN = \"let sql = 'SELECT 1';\"\n\nif OLD_PATTERN not in old_code:\n    print\\(f\"  WARNING: Pattern `{OLD_PATTERN}` not found in jsCode!\"\\)\n    # Show lines containing 'let sql' for debugging\n    for line in old_code.splitlines\\(\\):\n        if 'let sql' in line:\n            print\\(f\"    Found line: {line.strip\\(\\)}\"\\)\n    exit\\(1\\)\n\nnew_code = old_code.replace\\(OLD_PATTERN, NEW_PATTERN, 1\\)\nwf['nodes'][target_idx]['parameters']['jsCode'] = new_code\n\n# 5. Print old and new relevant lines\nprint\\(\"\\\\nStep 5: Showing old vs new lines...\"\\)\nfor line in old_code.splitlines\\(\\):\n    if 'let sql' in line:\n        print\\(f\"  OLD: {line.strip\\(\\)}\"\\)\nfor line in new_code.splitlines\\(\\):\n    if 'let sql' in line:\n        print\\(f\"  NEW: {line.strip\\(\\)}\"\\)\n\n# 6. PUT/save workflow\nprint\\(\"\\\\nStep 6: Saving workflow...\"\\)\nsave_result = api\\(\"PUT\", f\"/workflows/{WF_ID}\", wf\\)\nprint\\(f\"  Saved. Name: {save_result['name']}, Active: {save_result.get\\('active'\\)}\"\\)\n\n# 7. Activate workflow\nprint\\(\"\\\\nStep 7: Activating workflow...\"\\)\nact_result = api\\(\"POST\", f\"/workflows/{WF_ID}/activate\"\\)\nprint\\(f\"  Active: {act_result.get\\('active'\\)}\"\\)\n\n# 8. Verify\nprint\\(\"\\\\nStep 8: Verifying change...\"\\)\nwf_check = api\\(\"GET\", f\"/workflows/{WF_ID}\"\\)\nfor node in wf_check['nodes']:\n    if node['name'] == 'Create All Topics' and node['type'] == 'n8n-nodes-base.code':\n        code = node['parameters']['jsCode']\n        if NEW_PATTERN in code and OLD_PATTERN not in code:\n            print\\(\"  VERIFIED: Change applied successfully!\"\\)\n        else:\n            print\\(\"  ERROR: Change NOT found in saved workflow!\"\\)\n        # Show the relevant line\n        for line in code.splitlines\\(\\):\n            if 'let sql' in line:\n                print\\(f\"    Current: {line.strip\\(\\)}\"\\)\n        break\n\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"Done! Empty SQL fix applied to 'Create All Topics' node.\"\\)\nprint\\(\"Existing users pressing /start will no longer cause\"\\)\nprint\\(\"'Invalid query format' errors in the 'Save New Topics' node.\"\\)\nPYEOF)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\fix_topics_empty_sql.py\" << 'PYEOF'\nimport requests\nimport json\nimport urllib3\n\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nBASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nWF_ID = \"G52H2goZzpFSLUSa\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY, \"Content-Type\": \"application/json\"}\nVERIFY = False\n\ndef api\\(method, path, json_data=None\\):\n    url = f\"{BASE}/api/v1{path}\"\n    r = requests.request\\(method, url, headers=HEADERS, json=json_data, verify=VERIFY\\)\n    if not r.ok:\n        print\\(f\"  HTTP {r.status_code}: {r.text[:500]}\"\\)\n    r.raise_for_status\\(\\)\n    return r.json\\(\\)\n\n# 1. Deactivate workflow\nprint\\(\"=\" * 60\\)\nprint\\(\"Step 1: Deactivating workflow...\"\\)\nresult = api\\(\"POST\", f\"/workflows/{WF_ID}/deactivate\"\\)\nprint\\(f\"  Active: {result.get\\('active'\\)}\"\\)\n\n# 2. GET workflow\nprint\\(\"\\\\nStep 2: Fetching workflow...\"\\)\nwf = api\\(\"GET\", f\"/workflows/{WF_ID}\"\\)\nprint\\(f\"  Workflow: {wf['name']} \\(ID: {wf['id']}\\)\"\\)\nprint\\(f\"  Nodes count: {len\\(wf['nodes']\\)}\"\\)\n\n# 3. Find the \"Create All Topics\" node\nprint\\(\"\\\\nStep 3: Looking for 'Create All Topics' Code node...\"\\)\ntarget_node = None\ntarget_idx = None\nfor i, node in enumerate\\(wf['nodes']\\):\n    if node['name'] == 'Create All Topics' and node['type'] == 'n8n-nodes-base.code':\n        target_node = node\n        target_idx = i\n        break\n\nif target_node is None:\n    print\\(\"  ERROR: 'Create All Topics' node not found!\"\\)\n    exit\\(1\\)\n\nprint\\(f\"  Found node at index {target_idx}: {target_node['name']} \\(type: {target_node['type']}\\)\"\\)\n\n# 4. Replace in jsCode\nprint\\(\"\\\\nStep 4: Replacing `let sql = '';` with `let sql = 'SELECT 1';`...\"\\)\nold_code = target_node['parameters']['jsCode']\n\nOLD_PATTERN = \"let sql = '';\"\nNEW_PATTERN = \"let sql = 'SELECT 1';\"\n\nif OLD_PATTERN not in old_code:\n    print\\(f\"  WARNING: Pattern `{OLD_PATTERN}` not found in jsCode!\"\\)\n    for line in old_code.splitlines\\(\\):\n        if 'let sql' in line:\n            print\\(f\"    Found line: {line.strip\\(\\)}\"\\)\n    exit\\(1\\)\n\nnew_code = old_code.replace\\(OLD_PATTERN, NEW_PATTERN, 1\\)\nwf['nodes'][target_idx]['parameters']['jsCode'] = new_code\n\n# 5. Print old and new relevant lines\nprint\\(\"\\\\nStep 5: Showing old vs new lines...\"\\)\nfor line in old_code.splitlines\\(\\):\n    if 'let sql' in line:\n        print\\(f\"  OLD: {line.strip\\(\\)}\"\\)\nfor line in new_code.splitlines\\(\\):\n    if 'let sql' in line:\n        print\\(f\"  NEW: {line.strip\\(\\)}\"\\)\n\n# 6. PUT/save workflow - only send fields the API accepts\nprint\\(\"\\\\nStep 6: Saving workflow...\"\\)\n# Build a clean payload with only the fields n8n expects\npayload = {\n    \"name\": wf[\"name\"],\n    \"nodes\": wf[\"nodes\"],\n    \"connections\": wf[\"connections\"],\n    \"settings\": wf.get\\(\"settings\", {}\\),\n}\n# Include staticData if present\nif \"staticData\" in wf:\n    payload[\"staticData\"] = wf[\"staticData\"]\n\nsave_result = api\\(\"PUT\", f\"/workflows/{WF_ID}\", payload\\)\nprint\\(f\"  Saved. Name: {save_result['name']}, Active: {save_result.get\\('active'\\)}\"\\)\n\n# 7. Activate workflow\nprint\\(\"\\\\nStep 7: Activating workflow...\"\\)\nact_result = api\\(\"POST\", f\"/workflows/{WF_ID}/activate\"\\)\nprint\\(f\"  Active: {act_result.get\\('active'\\)}\"\\)\n\n# 8. Verify\nprint\\(\"\\\\nStep 8: Verifying change...\"\\)\nwf_check = api\\(\"GET\", f\"/workflows/{WF_ID}\"\\)\nfor node in wf_check['nodes']:\n    if node['name'] == 'Create All Topics' and node['type'] == 'n8n-nodes-base.code':\n        code = node['parameters']['jsCode']\n        if NEW_PATTERN in code and OLD_PATTERN not in code:\n            print\\(\"  VERIFIED: Change applied successfully!\"\\)\n        else:\n            print\\(\"  ERROR: Change NOT found in saved workflow!\"\\)\n        for line in code.splitlines\\(\\):\n            if 'let sql' in line:\n                print\\(f\"    Current: {line.strip\\(\\)}\"\\)\n        break\n\nprint\\(\"\\\\n\" + \"=\" * 60\\)\nprint\\(\"Done! Empty SQL fix applied to 'Create All Topics' node.\"\\)\nprint\\(\"Existing users pressing /start will no longer cause\"\\)\nprint\\(\"'Invalid query format' errors in the 'Save New Topics' node.\"\\)\nPYEOF)",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\full_check_all.py\" << 'PYEOF'\n#!/usr/bin/env python3\n\"\"\"Comprehensive check of ALL n8n workflows and mini app.\"\"\"\n\nimport requests\nimport json\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nAPI_BASE = \"https://n8n.creativeanalytic.ru\"\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nHEADERS = {\"X-N8N-API-KEY\": API_KEY, \"Accept\": \"application/json\"}\n\nWORKFLOWS = {\n    \"Stylize\":          \"3iZY--GtxZ556edSgZQuB\",\n    \"Multi-photo\":      \"FXRCdsL4ULHevtbz\",\n    \"Style-transfer\":   \"HbqrBmstlPbz9VxM\",\n    \"Video\":            \"fmTA4l0XfQXTajGI\",\n    \"Face-swap\":        \"qKyOmXDNPNvG9WH9\",\n    \"Remove-bg\":        \"z29Bx9CRXKvcHgvI\",\n    \"Enhance\":          \"Lfra98zYiGA0yKmD\",\n    \"Text-to-image\":    \"QP37jmBYCpeaCzYV\",\n    \"Bot-start-handler\":\"G52H2goZzpFSLUSa\",\n    \"Admin-stats\":      \"qgN7W1DXPTzYKU8d\",\n    \"Add-stars\":        \"Q4ND53LV9pUdviP5\",\n    \"Block-user\":       \"KiYTLoH2eIPmE4aN\",\n    \"Delete-user\":      \"p6AeskFh67roLORQ\",\n}\n\nGENERATION_WORKFLOWS = [\n    \"Stylize\", \"Multi-photo\", \"Style-transfer\", \"Video\",\n    \"Face-swap\", \"Remove-bg\", \"Enhance\", \"Text-to-image\"\n]\n\nWEBHOOK_ENDPOINTS = [\n    \"https://n8n.creativeanalytic.ru/webhook/generate\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-multi\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-style-transfer\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-video\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-face-swap\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-remove-bg\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-enhance\",\n    \"https://n8n.creativeanalytic.ru/webhook/generate-text-to-image\",\n]\n\nMINIAPP_URLS = [\n    \"https://avatar-bot-miniapp.vercel.app\",\n    \"https://avatar-bot-miniapp.vercel.app/assets/\",\n]\n\n\ndef get_workflow\\(wf_id\\):\n    url = f\"{API_BASE}/api/v1/workflows/{wf_id}\"\n    resp = requests.get\\(url, headers=HEADERS, verify=False, timeout=15\\)\n    resp.raise_for_status\\(\\)\n    return resp.json\\(\\)\n\n\ndef find_fal_model_url\\(nodes\\):\n    \"\"\"Find fal.ai model URL from HTTP Request nodes or Code nodes.\"\"\"\n    urls = []\n    for n in nodes:\n        ntype = n.get\\(\"type\", \"\"\\)\n        params = n.get\\(\"parameters\", {}\\)\n        # Check HTTP Request nodes for fal.ai URLs\n        if \"httpRequest\" in ntype or \"HttpRequest\" in ntype:\n            url_val = params.get\\(\"url\", \"\"\\)\n            if \"fal.ai\" in str\\(url_val\\) or \"fal.run\" in str\\(url_val\\):\n                urls.append\\(url_val\\)\n        # Check Code nodes that might reference fal\n        if \"code\" in ntype.lower\\(\\):\n            code = params.get\\(\"jsCode\", \"\"\\) or params.get\\(\"code\", \"\"\\)\n            if \"fal.ai\" in code or \"fal.run\" in code:\n                for line in code.split\\(\"\\\\n\"\\):\n                    if \"fal.ai\" in line or \"fal.run\" in line:\n                        line = line.strip\\(\\)\n                        for part in line.split\\(\"'\"\\) + line.split\\('\"'\\):\n                            if \"fal\" in part and \\(\"http\" in part or \"fal.ai/\" in part or \"fal.run/\" in part\\):\n                                urls.append\\(part.strip\\(\\)\\)\n        # Also check any string parameter that contains fal\n        for key, val in params.items\\(\\):\n            if key == \"jsCode\":\n                continue\n            if isinstance\\(val, str\\) and \\(\"fal.ai\" in val or \"fal.run\" in val\\):\n                if val.startswith\\(\"http\"\\) or \"fal.ai/\" in val or \"fal.run/\" in val:\n                    if val not in urls:\n                        urls.append\\(val\\)\n    # Deduplicate preserving order\n    seen = set\\(\\)\n    unique = []\n    for u in urls:\n        if u not in seen:\n            seen.add\\(u\\)\n            unique.append\\(u\\)\n    return unique\n\n\ndef find_webhook_path\\(nodes\\):\n    for n in nodes:\n        if \"webhook\" in n.get\\(\"type\", \"\"\\).lower\\(\\):\n            params = n.get\\(\"parameters\", {}\\)\n            path = params.get\\(\"path\", \"\"\\)\n            if path:\n                return path\n    return None\n\n\ndef check_stylize_prompt\\(nodes\\):\n    \"\"\"Check that stylize prompt is just the style expression, no suffix.\"\"\"\n    expected = \"{{ $\\('Extract Input Data'\\).first\\(\\).json.style }}\"\n    # Deep search all nodes' parameters for prompt containing 'Extract Input Data' and 'style'\n    for n in nodes:\n        params = n.get\\(\"parameters\", {}\\)\n        params_str = json.dumps\\(params\\)\n        if \"Extract Input Data\" not in params_str:\n            continue\n        # Search bodyParameters\n        body_params = params.get\\(\"bodyParameters\", {}\\)\n        if isinstance\\(body_params, dict\\):\n            parameters = body_params.get\\(\"parameters\", []\\)\n            if isinstance\\(parameters, list\\):\n                for p in parameters:\n                    if isinstance\\(p, dict\\) and p.get\\(\"name\"\\) == \"prompt\":\n                        val = p.get\\(\"value\", \"\"\\).strip\\(\\)\n                        return \\(val == expected\\), val\n        # Search sendBody / body / jsonBody\n        for key in [\"body\", \"jsonBody\", \"requestBody\"]:\n            val = params.get\\(key, \"\"\\)\n            if isinstance\\(val, str\\) and \"prompt\" in val and \"style\" in val:\n                # Try to parse as JSON\n                try:\n                    parsed = json.loads\\(val.replace\\(\"{{\", \"EXPR_START\"\\).replace\\(\"}}\", \"EXPR_END\"\\)\\)\n                except:\n                    pass\n        # Search in options\n        options = params.get\\(\"options\", {}\\)\n        if isinstance\\(options, dict\\):\n            for k, v in options.items\\(\\):\n                if isinstance\\(v, str\\) and \"prompt\" in v and \"style\" in v:\n                    pass\n        # Direct parameter search for prompt\n        if \"prompt\" in params:\n            val = params[\"prompt\"]\n            if isinstance\\(val, str\\) and \"style\" in val:\n                val = val.strip\\(\\)\n                return \\(val == expected\\), val\n    # Fallback: search ALL text content\n    for n in nodes:\n        params_str = json.dumps\\(n.get\\(\"parameters\", {}\\)\\)\n        if \"prompt\" in params_str and \"Extract Input Data\" in params_str and \"style\" in params_str:\n            # Try to extract the prompt value\n            import re\n            # Look for \"prompt\":\"VALUE\" pattern\n            matches = re.findall\\(r'\"prompt\"\\\\s*:\\\\s*\"\\(\\(?:[^\"\\\\\\\\]|\\\\\\\\.\\)*\\)\"', params_str\\)\n            for m in matches:\n                if \"style\" in m:\n                    m_clean = m.replace\\(\"\\\\\\\\n\", \"\\\\n\"\\).strip\\(\\)\n                    return \\(m_clean == expected\\), m_clean\n            # Look for \"value\":\"...\" after \"name\":\"prompt\"\n            matches2 = re.findall\\(r'\"name\"\\\\s*:\\\\s*\"prompt\".*?\"value\"\\\\s*:\\\\s*\"\\(\\(?:[^\"\\\\\\\\]|\\\\\\\\.\\)*\\)\"', params_str\\)\n            for m in matches2:\n                if \"style\" in m:\n                    m_clean = m.replace\\(\"\\\\\\\\n\", \"\\\\n\"\\).strip\\(\\)\n                    return \\(m_clean == expected\\), m_clean\n    return None, \"NOT FOUND\"\n\n\ndef check_stylize_guidance_scale\\(nodes\\):\n    \"\"\"Check that guidance_scale formula references creativity.\"\"\"\n    for n in nodes:\n        params = n.get\\(\"parameters\", {}\\)\n        params_str = json.dumps\\(params\\)\n        if \"guidance_scale\" in params_str:\n            if \"creativity\" in params_str:\n                return True\n            else:\n                return False\n    return None\n\n\ndef check_bot_start_create_topics\\(nodes\\):\n    \"\"\"Check that 'Create All Topics' code node contains let sql = 'SELECT 1';\"\"\"\n    node = None\n    for n in nodes:\n        name = n.get\\(\"name\", \"\"\\)\n        if \"create\" in name.lower\\(\\) and \"topic\" in name.lower\\(\\):\n            node = n\n            break\n    if not node:\n        return None, \"Node 'Create All Topics' not found\"\n    \n    params = node.get\\(\"parameters\", {}\\)\n    code = params.get\\(\"jsCode\", \"\"\\) or params.get\\(\"code\", \"\"\\)\n    \n    if \"let sql = 'SELECT 1';\" in code:\n        return True, \"Contains let sql = 'SELECT 1';\"\n    elif \"let sql = '';\" in code or 'let sql = \"\";' in code:\n        return False, \"Contains EMPTY string sql assignment\"\n    else:\n        for line in code.split\\(\"\\\\n\"\\):\n            if \"let sql\" in line:\n                return False, f\"Found: {line.strip\\(\\)}\"\n        return False, \"sql assignment not found in code\"\n\n\ndef print_separator\\(char=\"=\", length=100\\):\n    print\\(char * length\\)\n\n\ndef main\\(\\):\n    print_separator\\(\\)\n    print\\(\"  COMPREHENSIVE CHECK OF ALL WORKFLOWS AND MINI APP\"\\)\n    print_separator\\(\\)\n    print\\(\\)\n\n    # =====================================================================\n    # PART 1: Check all n8n workflows\n    # =====================================================================\n    print\\(\"PART 1: N8N WORKFLOW CHECK\"\\)\n    print_separator\\(\"-\"\\)\n    print\\(\\)\n\n    results = []\n    \n    for wf_name, wf_id in WORKFLOWS.items\\(\\):\n        print\\(f\"  Fetching: {wf_name} \\({wf_id}\\)...\"\\)\n        try:\n            wf = get_workflow\\(wf_id\\)\n        except Exception as e:\n            print\\(f\"    [FAIL] Could not fetch workflow: {e}\"\\)\n            results.append\\({\n                \"name\": wf_name,\n                \"id\": wf_id,\n                \"fetch_error\": str\\(e\\),\n            }\\)\n            continue\n\n        nodes = wf.get\\(\"nodes\", []\\)\n        active = wf.get\\(\"active\", False\\)\n        real_name = wf.get\\(\"name\", \"???\"\\)\n        node_count = len\\(nodes\\)\n        webhook_path = find_webhook_path\\(nodes\\)\n\n        result = {\n            \"name\": wf_name,\n            \"real_name\": real_name,\n            \"id\": wf_id,\n            \"active\": active,\n            \"node_count\": node_count,\n            \"webhook_path\": webhook_path,\n            \"fal_urls\": [],\n            \"prompt_ok\": None,\n            \"prompt_val\": None,\n            \"guidance_ok\": None,\n            \"bot_start_ok\": None,\n            \"bot_start_detail\": None,\n        }\n\n        # For generation workflows: find fal.ai model URL\n        if wf_name in GENERATION_WORKFLOWS:\n            fal_urls = find_fal_model_url\\(nodes\\)\n            result[\"fal_urls\"] = fal_urls\n\n        # Stylize-specific checks\n        if wf_name == \"Stylize\":\n            prompt_ok, prompt_val = check_stylize_prompt\\(nodes\\)\n            result[\"prompt_ok\"] = prompt_ok\n            result[\"prompt_val\"] = prompt_val\n            guidance_ok = check_stylize_guidance_scale\\(nodes\\)\n            result[\"guidance_ok\"] = guidance_ok\n\n        # Bot-start-handler check\n        if wf_name == \"Bot-start-handler\":\n            bsh_ok, bsh_detail = check_bot_start_create_topics\\(nodes\\)\n            result[\"bot_start_ok\"] = bsh_ok\n            result[\"bot_start_detail\"] = bsh_detail\n\n        results.append\\(result\\)\n\n    print\\(\\)\n    print_separator\\(\"=\"\\)\n    print\\(\"  WORKFLOW STATUS TABLE\"\\)\n    print_separator\\(\"=\"\\)\n    print\\(\\)\n\n    for r in results:\n        if r.get\\(\"fetch_error\"\\):\n            print\\(f\"  {r['name']:25s}  ID: {r['id']}\"\\)\n            print\\(f\"    [FAIL] Error: {r['fetch_error']}\"\\)\n            print\\(\\)\n            continue\n\n        active_icon = \"[OK]  \" if r.get\\(\"active\"\\) else \"[FAIL]\"\n        print\\(f\"  {r['name']:25s}  Real name: {r.get\\('real_name', '???'\\)}\"\\)\n        print\\(f\"    ID:            {r['id']}\"\\)\n        print\\(f\"    Active:        {active_icon}  \\({r.get\\('active'\\)}\\)\"\\)\n        print\\(f\"    Nodes:         {r.get\\('node_count', '?'\\)}\"\\)\n        print\\(f\"    Webhook path:  {r.get\\('webhook_path'\\) or 'N/A'}\"\\)\n\n        if r[\"name\"] in GENERATION_WORKFLOWS:\n            fal_urls = r.get\\(\"fal_urls\", []\\)\n            if fal_urls:\n                for u in fal_urls:\n                    print\\(f\"    fal.ai model:  {u}\"\\)\n            else:\n                print\\(f\"    fal.ai model:  \\(none found\\)\"\\)\n\n        if r[\"name\"] == \"Stylize\":\n            if r[\"prompt_ok\"] is True:\n                print\\(f\"    Prompt check:  [OK]   {r['prompt_val']}\"\\)\n            elif r[\"prompt_ok\"] is False:\n                print\\(f\"    Prompt check:  [FAIL] {r['prompt_val']}\"\\)\n            else:\n                print\\(f\"    Prompt check:  [????] {r['prompt_val']}\"\\)\n\n            if r[\"guidance_ok\"] is True:\n                print\\(f\"    Guidance/crea: [OK]   guidance_scale uses creativity\"\\)\n            elif r[\"guidance_ok\"] is False:\n                print\\(f\"    Guidance/crea: [FAIL] guidance_scale does NOT use creativity\"\\)\n            else:\n                print\\(f\"    Guidance/crea: [????] guidance_scale not found\"\\)\n\n        if r[\"name\"] == \"Bot-start-handler\":\n            if r[\"bot_start_ok\"] is True:\n                print\\(f\"    Create Topics: [OK]   {r['bot_start_detail']}\"\\)\n            elif r[\"bot_start_ok\"] is False:\n                print\\(f\"    Create Topics: [FAIL] {r['bot_start_detail']}\"\\)\n            else:\n                print\\(f\"    Create Topics: [????] {r['bot_start_detail']}\"\\)\n\n        print\\(\\)\n\n    # =====================================================================\n    # PART 2: Check webhook endpoints\n    # =====================================================================\n    print_separator\\(\"=\"\\)\n    print\\(\"  PART 2: WEBHOOK ENDPOINT CHECK\"\\)\n    print_separator\\(\"=\"\\)\n    print\\(\\)\n\n    for url in WEBHOOK_ENDPOINTS:\n        try:\n            resp = requests.options\\(url, verify=False, timeout=10\\)\n            status = resp.status_code\n            if status == 404:\n                icon = \"[FAIL]\"\n            else:\n                icon = \"[OK]  \"\n            print\\(f\"  {icon}  {status}  {url}\"\\)\n        except Exception as e:\n            print\\(f\"  [FAIL]  ERR  {url}  \\({e}\\)\"\\)\n\n    print\\(\\)\n\n    # =====================================================================\n    # PART 3: Check mini app availability\n    # =====================================================================\n    print_separator\\(\"=\"\\)\n    print\\(\"  PART 3: MINI APP AVAILABILITY CHECK\"\\)\n    print_separator\\(\"=\"\\)\n    print\\(\\)\n\n    for url in MINIAPP_URLS:\n        try:\n            resp = requests.get\\(url, verify=False, timeout=10\\)\n            status = resp.status_code\n            if status == 200:\n                icon = \"[OK]  \"\n            else:\n                icon = \"[FAIL]\"\n            print\\(f\"  {icon}  {status}  {url}\"\\)\n        except Exception as e:\n            print\\(f\"  [FAIL]  ERR  {url}  \\({e}\\)\"\\)\n\n    print\\(\\)\n    print_separator\\(\"=\"\\)\n    print\\(\"  CHECK COMPLETE\"\\)\n    print_separator\\(\"=\"\\)\n\n    # =====================================================================\n    # SUMMARY\n    # =====================================================================\n    print\\(\\)\n    print\\(\"SUMMARY:\"\\)\n    print_separator\\(\"-\"\\)\n    \n    total = len\\(results\\)\n    active_count = sum\\(1 for r in results if r.get\\(\"active\"\\)\\)\n    fetch_errors = [r[\"name\"] for r in results if r.get\\(\"fetch_error\"\\)]\n    inactive = [r[\"name\"] for r in results if not r.get\\(\"active\"\\) and not r.get\\(\"fetch_error\"\\)]\n\n    print\\(f\"  Total workflows:    {total}\"\\)\n    print\\(f\"  Active:             {active_count}\"\\)\n    print\\(f\"  Inactive:           {len\\(inactive\\)}\"\\)\n    print\\(f\"  Fetch errors:       {len\\(fetch_errors\\)}\"\\)\n    \n    if inactive:\n        print\\(f\"  Inactive list:      {', '.join\\(inactive\\)}\"\\)\n    if fetch_errors:\n        print\\(f\"  Error list:         {', '.join\\(fetch_errors\\)}\"\\)\n    \n    print\\(\\)\n\n\nif __name__ == \"__main__\":\n    main\\(\\)\nPYEOF)",
      "Bash(powershell -NoProfile -Command \"& { $b64=''IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIyMgQ29tcHJlaGVuc2l2ZSBjaGVjayBvZiBBTEwgbjhuIHdvcmtmbG93cyBhbmQgbWluaSBhcHAuCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IHJlCmltcG9ydCB1cmxsaWIzCnVybGxpYjMuZGlzYWJsZV93YXJuaW5ncyh1cmxsaWIzLmV4Y2VwdGlvbnMuSW5zZWN1cmVSZXF1ZXN0V2FybmluZykKCkFQSV9CQVNFID0gImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUiCkFQSV9LRVkgPSAiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lJM1lqbG1Nemd3TFRCa1ptVXROREEwWVMxaE5qYzNMV0poTlRRd1ltSm1OVEF4TVNJc0ltbHpjeUk2SW00NGJpSXNJbUYxWkNJNkluQjFZbXhwWXkxaGNHa2lMQ0pwWVhRaU9qRTNOekEyTlRBM09UUXNJbVY0Y0NJNk1UYzNNekl3TVRZd01IMC5VVkczV0VVVWhzZ2xROGg0U1o5MmpwMUp6VGNKX1VRWWlTcDZyMEZrN2pZIgpIRUFERVJTID0geyJYLU44Ti1BUEktS0VZIjogQVBJX0tFWSwgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIn0KCldPUktGTE9XUyA9IHsKICAgICJTdHlsaXplIjogICAgICAgICAgICIzaVpZLS1HdHhaWjU1NmVkU2dacXVCIiwKICAgICJNdWx0aS1waG90byI6ICAgICAgICJGWFJDZHNMNFVMSGV2dGJ6IiwKICAgICJTdHlsZS10cmFuc2ZlciI6ICAgICJIYnFyQm1zdGxQYno5VnhNIiwKICAgICJWaWRlbyI6ICAgICAgICAgICAgICJmbVRBNGwwWGZRWFRhakdJIiwKICAgICJGYWNlLXN3YXAiOiAgICAgICAgICJxS3lPbVhETlBOdkc5V0g5IiwKICAgICJSZW1vdmUtYmciOiAgICAgICAgICJ6MjlCeDlDUlhLdmNIZ3ZJIiwKICAgICJFbmhhbmNlIjogICAgICAgICAgICJMZnJhOTh6WWlHQTB5S21EIiwKICAgICJUZXh0LXRvLWltYWdlIjogICAgICJRUDM3am1CWUNwZWFDellWIiwKICAgICJCb3Qtc3RhcnQtaGFuZGxlciI6ICJHNTJIMmdvWnpwRlNMVVNhIiwKICAgICJBZG1pbi1zdGF0cyI6ICAgICAgICJxZ043VzFEWFBUellLVThkIiwKICAgICJBZGQtc3RhcnMiOiAgICAgICAgICJRNE5ENTNMVjlwVWR2aVA1IiwKICAgICJCbG9jay11c2VyIjogICAgICAgICJLaVlUTG9IMmVJUG1FNGFOIiwKICAgICJEZWxldGUtdXNlciI6ICAgICAgICJwNkFlc2tGaDY3cm9MT1JRIiwKfQoKR0VORVJBVElPTl9XT1JLRkxPV1MgPSBbCiAgICAiU3R5bGl6ZSIsICJNdWx0aS1waG90byIsICJTdHlsZS10cmFuc2ZlciIsICJWaWRlbyIsCiAgICAiRmFjZS1zd2FwIiwgIlJlbW92ZS1iZyIsICJFbmhhbmNlIiwgIlRleHQtdG8taW1hZ2UiCl0KCldFQkhPT0tfRU5EUE9JTlRTID0gWwogICAgImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUvd2ViaG9vay9nZW5lcmF0ZSIsCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLW11bHRpIiwKICAgICJodHRwczovL244bi5jcmVhdGl2ZWFuYWx5dGljLnJ1L3dlYmhvb2svZ2VuZXJhdGUtc3R5bGUtdHJhbnNmZXIiLAogICAgImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUvd2ViaG9vay9nZW5lcmF0ZS12aWRlbyIsCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLWZhY2Utc3dhcCIsCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLXJlbW92ZS1iZyIsCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLWVuaGFuY2UiLAogICAgImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUvd2ViaG9vay9nZW5lcmF0ZS10ZXh0LXRvLWltYWdlIiwKXQoKTUlOSUFQUF9VUkxTID0gWwogICAgImh0dHBzOi8vYXZhdGFyLWJvdC1taW5pYXBwLnZlcmNlbC5hcHAiLAogICAgImh0dHBzOi8vYXZhdGFyLWJvdC1taW5pYXBwLnZlcmNlbC5hcHAvYXNzZXRzLyIsCl0KCgpkZWYgZ2V0X3dvcmtmbG93KHdmX2lkKToKICAgIHVybCA9IGYie0FQSV9CQVNFfS9hcGkvdjEvd29ya2Zsb3dzL3t3Zl9pZH0iCiAgICByZXNwID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1IRUFERVJTLCB2ZXJpZnk9RmFsc2UsIHRpbWVvdXQ9MTUpCiAgICByZXNwLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgcmV0dXJuIHJlc3AuanNvbigpCgoKZGVmIGZpbmRfZmFsX21vZGVsX3VybChub2Rlcyk6CiAgICB1cmxzID0gW10KICAgIGZvciBuIGluIG5vZGVzOgogICAgICAgIG50eXBlID0gbi5nZXQoInR5cGUiLCAiIikKICAgICAgICBwYXJhbXMgPSBuLmdldCgicGFyYW1ldGVycyIsIHt9KQogICAgICAgIGlmICJodHRwUmVxdWVzdCIgaW4gbnR5cGUgb3IgIkh0dHBSZXF1ZXN0IiBpbiBudHlwZToKICAgICAgICAgICAgdXJsX3ZhbCA9IHBhcmFtcy5nZXQoInVybCIsICIiKQogICAgICAgICAgICBpZiAiZmFsLmFpIiBpbiBzdHIodXJsX3ZhbCkgb3IgImZhbC5ydW4iIGluIHN0cih1cmxfdmFsKToKICAgICAgICAgICAgICAgIHVybHMuYXBwZW5kKHN0cih1cmxfdmFsKSkKICAgICAgICBpZiAiY29kZSIgaW4gbnR5cGUubG93ZXIoKToKICAgICAgICAgICAgY29kZSA9IHBhcmFtcy5nZXQoImpzQ29kZSIsICIiKSBvciBwYXJhbXMuZ2V0KCJjb2RlIiwgIiIpCiAgICAgICAgICAgIGlmICJmYWwuYWkiIGluIGNvZGUgb3IgImZhbC5ydW4iIGluIGNvZGU6CiAgICAgICAgICAgICAgICBmb3VuZCA9IHJlLmZpbmRhbGwocidodHRwcz86Ly9bXlxzXCdcImAsXCldKmZhbFwuW15cc1wnXCJgLFwpXSsnLCBjb2RlKQogICAgICAgICAgICAgICAgdXJscy5leHRlbmQoZm91bmQpCiAgICAgICAgZm9yIGtleSwgdmFsIGluIHBhcmFtcy5pdGVtcygpOgogICAgICAgICAgICBpZiBrZXkgaW4gKCJqc0NvZGUiLCAiY29kZSIpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWwsIHN0cikgYW5kICgiZmFsLmFpIiBpbiB2YWwgb3IgImZhbC5ydW4iIGluIHZhbCkgYW5kICJodHRwIiBpbiB2YWw6CiAgICAgICAgICAgICAgICB1cmxzLmFwcGVuZCh2YWwpCiAgICBzZWVuID0gc2V0KCkKICAgIHVuaXF1ZSA9IFtdCiAgICBmb3IgdSBpbiB1cmxzOgogICAgICAgIHUgPSB1LnJzdHJpcCgiLyIpLnJzdHJpcCgiOyIpCiAgICAgICAgaWYgdSBub3QgaW4gc2VlbjoKICAgICAgICAgICAgc2Vlbi5hZGQodSkKICAgICAgICAgICAgdW5pcXVlLmFwcGVuZCh1KQogICAgcmV0dXJuIHVuaXF1ZQoKCmRlZiBmaW5kX3dlYmhvb2tfcGF0aChub2Rlcyk6CiAgICBmb3IgbiBpbiBub2RlczoKICAgICAgICBpZiAid2ViaG9vayIgaW4gbi5nZXQoInR5cGUiLCAiIikubG93ZXIoKToKICAgICAgICAgICAgcGFyYW1zID0gbi5nZXQoInBhcmFtZXRlcnMiLCB7fSkKICAgICAgICAgICAgcGF0aCA9IHBhcmFtcy5nZXQoInBhdGgiLCAiIikKICAgICAgICAgICAgaWYgcGF0aDoKICAgICAgICAgICAgICAgIHJldHVybiBwYXRoCiAgICByZXR1cm4gTm9uZQoKCmRlZiBjaGVja19zdHlsaXplX3Byb21wdChub2Rlcyk6CiAgICBleHBlY3RlZCA9ICJ7eyAkKCdFeHRyYWN0IElucHV0IERhdGEnKS5maXJzdCgpLmpzb24uc3R5bGUgfX0iCiAgICBmb3IgbiBpbiBub2RlczoKICAgICAgICBwYXJhbXMgPSBuLmdldCgicGFyYW1ldGVycyIsIHt9KQogICAgICAgIHBhcmFtc19zdHIgPSBqc29uLmR1bXBzKHBhcmFtcykKICAgICAgICBpZiAiRXh0cmFjdCBJbnB1dCBEYXRhIiBub3QgaW4gcGFyYW1zX3N0ciBvciAic3R5bGUiIG5vdCBpbiBwYXJhbXNfc3RyOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGJvZHlfcGFyYW1zID0gcGFyYW1zLmdldCgiYm9keVBhcmFtZXRlcnMiLCB7fSkKICAgICAgICBpZiBpc2luc3RhbmNlKGJvZHlfcGFyYW1zLCBkaWN0KToKICAgICAgICAgICAgcGFyYW1ldGVycyA9IGJvZHlfcGFyYW1zLmdldCgicGFyYW1ldGVycyIsIFtdKQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHBhcmFtZXRlcnMsIGxpc3QpOgogICAgICAgICAgICAgICAgZm9yIHAgaW4gcGFyYW1ldGVyczoKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHAsIGRpY3QpIGFuZCBwLmdldCgibmFtZSIpID09ICJwcm9tcHQiOgogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBwLmdldCgidmFsdWUiLCAiIikuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbCA9PSBleHBlY3RlZCksIHZhbAogICAgICAgIGlmICJwcm9tcHQiIGluIHBhcmFtczoKICAgICAgICAgICAgdmFsID0gcGFyYW1zWyJwcm9tcHQiXQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHZhbCwgc3RyKSBhbmQgInN0eWxlIiBpbiB2YWw6CiAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3RyaXAoKQogICAgICAgICAgICAgICAgcmV0dXJuICh2YWwgPT0gZXhwZWN0ZWQpLCB2YWwKICAgICAgICBtYXRjaGVzID0gcmUuZmluZGFsbChyJyJuYW1lIlxzKjpccyoicHJvbXB0IltefV0qPyJ2YWx1ZSJccyo6XHMqIigoPzpbXiJcXF18XFwuKSopIicsIHBhcmFtc19zdHIpCiAgICAgICAgZm9yIG0gaW4gbWF0Y2hlczoKICAgICAgICAgICAgaWYgInN0eWxlIiBpbiBtOgogICAgICAgICAgICAgICAgbV9jbGVhbiA9IG0ucmVwbGFjZSgiXFxuIiwgIlxuIikuc3RyaXAoKQogICAgICAgICAgICAgICAgcmV0dXJuIChtX2NsZWFuID09IGV4cGVjdGVkKSwgbV9jbGVhbgogICAgcmV0dXJuIE5vbmUsICJOT1QgRk9VTkQiCgoKZGVmIGNoZWNrX3N0eWxpemVfZ3VpZGFuY2Vfc2NhbGUobm9kZXMpOgogICAgZm9yIG4gaW4gbm9kZXM6CiAgICAgICAgcGFyYW1zID0gbi5nZXQoInBhcmFtZXRlcnMiLCB7fSkKICAgICAgICBwYXJhbXNfc3RyID0ganNvbi5kdW1wcyhwYXJhbXMpCiAgICAgICAgaWYgImd1aWRhbmNlX3NjYWxlIiBpbiBwYXJhbXNfc3RyOgogICAgICAgICAgICBpZiAiY3JlYXRpdml0eSIgaW4gcGFyYW1zX3N0cjoKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIE5vbmUKCgpkZWYgY2hlY2tfYm90X3N0YXJ0X2NyZWF0ZV90b3BpY3Mobm9kZXMpOgogICAgbm9kZSA9IE5vbmUKICAgIGZvciBuIGluIG5vZGVzOgogICAgICAgIG5hbWUgPSBuLmdldCgibmFtZSIsICIiKQogICAgICAgIGlmICJjcmVhdGUiIGluIG5hbWUubG93ZXIoKSBhbmQgInRvcGljIiBpbiBuYW1lLmxvd2VyKCk6CiAgICAgICAgICAgIG5vZGUgPSBuCiAgICAgICAgICAgIGJyZWFrCiAgICBpZiBub3Qgbm9kZToKICAgICAgICByZXR1cm4gTm9uZSwgIk5vZGUgQ3JlYXRlIEFsbCBUb3BpY3Mgbm90IGZvdW5kIgogICAgcGFyYW1zID0gbm9kZS5nZXQoInBhcmFtZXRlcnMiLCB7fSkKICAgIGNvZGUgPSBwYXJhbXMuZ2V0KCJqc0NvZGUiLCAiIikgb3IgcGFyYW1zLmdldCgiY29kZSIsICIiKQogICAgaWYgImxldCBzcWwgPSAnU0VMRUNUIDEnOyIgaW4gY29kZToKICAgICAgICByZXR1cm4gVHJ1ZSwgIkNvbnRhaW5zOiBsZXQgc3FsID0gJ1NFTEVDVCAxJzsiCiAgICBlbGlmICJsZXQgc3FsID0gJyc7IiBpbiBjb2RlOgogICAgICAgIHJldHVybiBGYWxzZSwgIkNvbnRhaW5zIEVNUFRZIHN0cmluZyBzcWwgYXNzaWdubWVudCIKICAgIGVsc2U6CiAgICAgICAgZm9yIGxpbmUgaW4gY29kZS5zcGxpdCgnXG4nKToKICAgICAgICAgICAgaWYgImxldCBzcWwiIGluIGxpbmU6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UsIGYiRm91bmQ6IHtsaW5lLnN0cmlwKCl9IgogICAgICAgIHJldHVybiBGYWxzZSwgInNxbCBhc3NpZ25tZW50IG5vdCBmb3VuZCBpbiBjb2RlIgoKCmRlZiBzZXAoY2hhcj0iPSIsIGxlbmd0aD0xMDApOgogICAgcHJpbnQoY2hhciAqIGxlbmd0aCkKCgpkZWYgbWFpbigpOgogICAgc2VwKCkKICAgIHByaW50KCIgIENPTVBSRUhFTlNJVkUgQ0hFQ0sgT0YgQUxMIFdPUktGTE9XUyBBTkQgTUlOSSBBUFAiKQogICAgc2VwKCkKICAgIHByaW50KCkKCiAgICBwcmludCgiUEFSVCAxOiBOOE4gV09SS0ZMT1cgQ0hFQ0siKQogICAgc2VwKCItIikKICAgIHByaW50KCkKCiAgICByZXN1bHRzID0gW10KICAgIGZvciB3Zl9uYW1lLCB3Zl9pZCBpbiBXT1JLRkxPV1MuaXRlbXMoKToKICAgICAgICBwcmludChmIiAgRmV0Y2hpbmc6IHt3Zl9uYW1lfSAoe3dmX2lkfSkuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgd2YgPSBnZXRfd29ya2Zsb3cod2ZfaWQpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIiAgICBbRkFJTF0gQ291bGQgbm90IGZldGNoOiB7ZX0iKQogICAgICAgICAgICByZXN1bHRzLmFwcGVuZCh7Im5hbWUiOiB3Zl9uYW1lLCAiaWQiOiB3Zl9pZCwgImZldGNoX2Vycm9yIjogc3RyKGUpfSkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgbm9kZXMgPSB3Zi5nZXQoIm5vZGVzIiwgW10pCiAgICAgICAgYWN0aXZlID0gd2YuZ2V0KCJhY3RpdmUiLCBGYWxzZSkKICAgICAgICByZWFsX25hbWUgPSB3Zi5nZXQoIm5hbWUiLCAiPz8/IikKICAgICAgICBub2RlX2NvdW50ID0gbGVuKG5vZGVzKQogICAgICAgIHdlYmhvb2tfcGF0aCA9IGZpbmRfd2ViaG9va19wYXRoKG5vZGVzKQoKICAgICAgICByID0gewogICAgICAgICAgICAibmFtZSI6IHdmX25hbWUsICJyZWFsX25hbWUiOiByZWFsX25hbWUsICJpZCI6IHdmX2lkLAogICAgICAgICAgICAiYWN0aXZlIjogYWN0aXZlLCAibm9kZV9jb3VudCI6IG5vZGVfY291bnQsICJ3ZWJob29rX3BhdGgiOiB3ZWJob29rX3BhdGgsCiAgICAgICAgICAgICJmYWxfdXJscyI6IFtdLCAicHJvbXB0X29rIjogTm9uZSwgInByb21wdF92YWwiOiBOb25lLAogICAgICAgICAgICAiZ3VpZGFuY2Vfb2siOiBOb25lLCAiYm90X3N0YXJ0X29rIjogTm9uZSwgImJvdF9zdGFydF9kZXRhaWwiOiBOb25lLAogICAgICAgIH0KCiAgICAgICAgaWYgd2ZfbmFtZSBpbiBHRU5FUkFUSU9OX1dPUktGTE9XUzoKICAgICAgICAgICAgclsiZmFsX3VybHMiXSA9IGZpbmRfZmFsX21vZGVsX3VybChub2RlcykKCiAgICAgICAgaWYgd2ZfbmFtZSA9PSAiU3R5bGl6ZSI6CiAgICAgICAgICAgIHJbInByb21wdF9vayJdLCByWyJwcm9tcHRfdmFsIl0gPSBjaGVja19zdHlsaXplX3Byb21wdChub2RlcykKICAgICAgICAgICAgclsiZ3VpZGFuY2Vfb2siXSA9IGNoZWNrX3N0eWxpemVfZ3VpZGFuY2Vfc2NhbGUobm9kZXMpCgogICAgICAgIGlmIHdmX25hbWUgPT0gIkJvdC1zdGFydC1oYW5kbGVyIjoKICAgICAgICAgICAgclsiYm90X3N0YXJ0X29rIl0sIHJbImJvdF9zdGFydF9kZXRhaWwiXSA9IGNoZWNrX2JvdF9zdGFydF9jcmVhdGVfdG9waWNzKG5vZGVzKQoKICAgICAgICByZXN1bHRzLmFwcGVuZChyKQoKICAgIHByaW50KCkKICAgIHNlcCgiPSIpCiAgICBwcmludCgiICBXT1JLRkxPVyBTVEFUVVMgVEFCTEUiKQogICAgc2VwKCI9IikKICAgIHByaW50KCkKCiAgICBmb3IgciBpbiByZXN1bHRzOgogICAgICAgIGlmIHIuZ2V0KCJmZXRjaF9lcnJvciIpOgogICAgICAgICAgICBwcmludChmIiAge3JbJ25hbWUnXToyNXN9ICBJRDoge3JbJ2lkJ119IikKICAgICAgICAgICAgcHJpbnQoZiIgICAgW0ZBSUxdIEVycm9yOiB7clsnZmV0Y2hfZXJyb3InXX0iKQogICAgICAgICAgICBwcmludCgpCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGFjdGl2ZV9pY29uID0gIltPS10gICIgaWYgclsiYWN0aXZlIl0gZWxzZSAiW0ZBSUxdIgogICAgICAgIHByaW50KGYiICB7clsnbmFtZSddOjI1c30gIFJlYWwgbmFtZToge3JbJ3JlYWxfbmFtZSddfSIpCiAgICAgICAgcHJpbnQoZiIgICAgSUQ6ICAgICAgICAgICAge3JbJ2lkJ119IikKICAgICAgICBwcmludChmIiAgICBBY3RpdmU6ICAgICAgICB7YWN0aXZlX2ljb259ICAoe3JbJ2FjdGl2ZSddfSkiKQogICAgICAgIHByaW50KGYiICAgIE5vZGVzOiAgICAgICAgIHtyWydub2RlX2NvdW50J119IikKICAgICAgICBwcmludChmIiAgICBXZWJob29rIHBhdGg6ICB7clsnd2ViaG9va19wYXRoJ10gb3IgJ04vQSd9IikKCiAgICAgICAgaWYgclsibmFtZSJdIGluIEdFTkVSQVRJT05fV09SS0ZMT1dTOgogICAgICAgICAgICBpZiByWyJmYWxfdXJscyJdOgogICAgICAgICAgICAgICAgZm9yIHUgaW4gclsiZmFsX3VybHMiXToKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICBmYWwuYWkgbW9kZWw6ICB7dX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgZmFsLmFpIG1vZGVsOiAgKG5vbmUgZm91bmQpIikKCiAgICAgICAgaWYgclsibmFtZSJdID09ICJTdHlsaXplIjoKICAgICAgICAgICAgaWYgclsicHJvbXB0X29rIl0gaXMgVHJ1ZToKICAgICAgICAgICAgICAgIHByaW50KGYiICAgIFByb21wdCBjaGVjazogIFtPS10gICB7clsncHJvbXB0X3ZhbCddfSIpCiAgICAgICAgICAgIGVsaWYgclsicHJvbXB0X29rIl0gaXMgRmFsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIiAgICBQcm9tcHQgY2hlY2s6ICBbRkFJTF0ge3JbJ3Byb21wdF92YWwnXX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgUHJvbXB0IGNoZWNrOiAgWz8/Pz9dIHtyWydwcm9tcHRfdmFsJ119IikKICAgICAgICAgICAgaWYgclsiZ3VpZGFuY2Vfb2siXSBpcyBUcnVlOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgR3VpZGFuY2UvY3JlYTogW09LXSAgIGd1aWRhbmNlX3NjYWxlIHVzZXMgY3JlYXRpdml0eSIpCiAgICAgICAgICAgIGVsaWYgclsiZ3VpZGFuY2Vfb2siXSBpcyBGYWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiICAgIEd1aWRhbmNlL2NyZWE6IFtGQUlMXSBndWlkYW5jZV9zY2FsZSBkb2VzIE5PVCB1c2UgY3JlYXRpdml0eSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIiAgICBHdWlkYW5jZS9jcmVhOiBbPz8/P10gZ3VpZGFuY2Vfc2NhbGUgbm90IGZvdW5kIikKCiAgICAgICAgaWYgclsibmFtZSJdID09ICJCb3Qtc3RhcnQtaGFuZGxlciI6CiAgICAgICAgICAgIGlmIHJbImJvdF9zdGFydF9vayJdIGlzIFRydWU6CiAgICAgICAgICAgICAgICBwcmludChmIiAgICBDcmVhdGUgVG9waWNzOiBbT0tdICAge3JbJ2JvdF9zdGFydF9kZXRhaWwnXX0iKQogICAgICAgICAgICBlbGlmIHJbImJvdF9zdGFydF9vayJdIGlzIEZhbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgQ3JlYXRlIFRvcGljczogW0ZBSUxdIHtyWydib3Rfc3RhcnRfZGV0YWlsJ119IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiICAgIENyZWF0ZSBUb3BpY3M6IFs/Pz8/XSB7clsnYm90X3N0YXJ0X2RldGFpbCddfSIpCgogICAgICAgIHByaW50KCkKCiAgICBzZXAoIj0iKQogICAgcHJpbnQoIiAgUEFSVCAyOiBXRUJIT09LIEVORFBPSU5UIENIRUNLIikKICAgIHNlcCgiPSIpCiAgICBwcmludCgpCgogICAgZm9yIHVybCBpbiBXRUJIT09LX0VORFBPSU5UUzoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0cy5vcHRpb25zKHVybCwgdmVyaWZ5PUZhbHNlLCB0aW1lb3V0PTEwKQogICAgICAgICAgICBzdGF0dXMgPSByZXNwLnN0YXR1c19jb2RlCiAgICAgICAgICAgIGljb24gPSAiW0ZBSUxdIiBpZiBzdGF0dXMgPT0gNDA0IGVsc2UgIltPS10gICIKICAgICAgICAgICAgcHJpbnQoZiIgIHtpY29ufSAge3N0YXR1c30gIHt1cmx9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiICBbRkFJTF0gIEVSUiAge3VybH0gICh7ZX0pIikKCiAgICBwcmludCgpCgogICAgc2VwKCI9IikKICAgIHByaW50KCIgIFBBUlQgMzogTUlOSSBBUFAgQVZBSUxBQklMSVRZIENIRUNLIikKICAgIHNlcCgiPSIpCiAgICBwcmludCgpCgogICAgZm9yIHVybCBpbiBNSU5JQVBQX1VSTFM6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwID0gcmVxdWVzdHMuZ2V0KHVybCwgdmVyaWZ5PUZhbHNlLCB0aW1lb3V0PTEwKQogICAgICAgICAgICBzdGF0dXMgPSByZXNwLnN0YXR1c19jb2RlCiAgICAgICAgICAgIGljb24gPSAiW09LXSAgIiBpZiBzdGF0dXMgPT0gMjAwIGVsc2UgIltGQUlMXSIKICAgICAgICAgICAgcHJpbnQoZiIgIHtpY29ufSAge3N0YXR1c30gIHt1cmx9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiICBbRkFJTF0gIEVSUiAge3VybH0gICh7ZX0pIikKCiAgICBwcmludCgpCiAgICBzZXAoIj0iKQogICAgcHJpbnQoIiAgQ0hFQ0sgQ09NUExFVEUiKQogICAgc2VwKCI9IikKCiAgICBwcmludCgpCiAgICBwcmludCgiU1VNTUFSWToiKQogICAgc2VwKCItIikKICAgIHRvdGFsID0gbGVuKHJlc3VsdHMpCiAgICBhY3RpdmVfY291bnQgPSBzdW0oMSBmb3IgciBpbiByZXN1bHRzIGlmIHIuZ2V0KCJhY3RpdmUiKSkKICAgIGZldGNoX2Vycm9ycyA9IFtyWyJuYW1lIl0gZm9yIHIgaW4gcmVzdWx0cyBpZiByLmdldCgiZmV0Y2hfZXJyb3IiKV0KICAgIGluYWN0aXZlID0gW3JbIm5hbWUiXSBmb3IgciBpbiByZXN1bHRzIGlmIG5vdCByLmdldCgiYWN0aXZlIikgYW5kIG5vdCByLmdldCgiZmV0Y2hfZXJyb3IiKV0KICAgIHByaW50KGYiICBUb3RhbCB3b3JrZmxvd3M6ICAgIHt0b3RhbH0iKQogICAgcHJpbnQoZiIgIEFjdGl2ZTogICAgICAgICAgICAge2FjdGl2ZV9jb3VudH0iKQogICAgcHJpbnQoZiIgIEluYWN0aXZlOiAgICAgICAgICAge2xlbihpbmFjdGl2ZSl9IikKICAgIHByaW50KGYiICBGZXRjaCBlcnJvcnM6ICAgICAgIHtsZW4oZmV0Y2hfZXJyb3JzKX0iKQogICAgaWYgaW5hY3RpdmU6CiAgICAgICAgcHJpbnQoZiIgIEluYWN0aXZlIGxpc3Q6ICAgICAgeycgLCAnLmpvaW4oaW5hY3RpdmUpfSIpCiAgICBpZiBmZXRjaF9lcnJvcnM6CiAgICAgICAgcHJpbnQoZiIgIEVycm9yIGxpc3Q6ICAgICAgICAgeycgLCAnLmpvaW4oZmV0Y2hfZXJyb3JzKX0iKQogICAgcHJpbnQoKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK''; $bytes = [System.Convert]::FromBase64String\\($b64\\); $text = [System.Text.Encoding]::UTF8.GetString\\($bytes\\); [System.IO.File]::WriteAllText\\(''C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\full_check_all.py'', $text, [System.Text.Encoding]::UTF8\\); Write-Host \\(''Written '' + $text.Length + '' chars''\\) }\")",
      "Bash(printf '%s' 'IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIyMgQ29tcHJlaGVuc2l2ZSBjaGVjayBvZiBBTEwgbjhuIHdvcmtmbG93cyBhbmQgbWluaSBhcHAuCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IHJlCmltcG9ydCB1cmxsaWIzCnVybGxpYjMuZGlzYWJsZV93YXJuaW5ncyh1cmxsaWIzLmV4Y2VwdGlvbnMuSW5zZWN1cmVSZXF1ZXN0V2FybmluZykK')",
      "Bash(powershell -NoProfile -File - << 'PS1EOF'\n$b64 = \"IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMw0KIyMjIENvbXByZWhlbnNpdmUgY2hlY2sgb2YgQUxMIG44biB3b3JrZmxvd3MgYW5kIG1pbmkgYXBwLg0KDQppbXBvcnQgcmVxdWVzdHMNCmltcG9ydCBqc29uDQppbXBvcnQgcmUNCmltcG9ydCB1cmxsaWIzDQp1cmxsaWIzLmRpc2FibGVfd2FybmluZ3ModXJsbGliMy5leGNlcHRpb25zLkluc2VjdXJlUmVxdWVzdFdhcm5pbmcpDQoNCkFQSV9CQVNFID0gImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUiDQpBUElfS0VZID0gImV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUp6ZFdJaU9pSTNZamxtTXpnd0xUQmtabVV0TkRBMFlTMWhOamMzTFdKaE5UUXdZbUptTlRBeE1TSXNJbWx6Y3lJNkltNDRiaUlzSW1GMVpDSTZJbkIxWW14cFl5MWhjR2tpTENKcFlYUWlPakUzTnpBMk5UQTNPVFFzSW1WNGNDSTZNVGMzTXpJd01UWXdNSDAuVVZHM1dFVVVoc2dsUThoNFNaOTJqcDFKelRjSl9VUVlpU3A2cjBGazdqWSINCkhFQURFUlMgPSB7IlgtTjhOLUFQSS1LRVkiOiBBUElfS0VZLCAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24ifQ0KDQpXT1JLRkxPV1MgPSB7DQogICAgIlN0eWxpemUiOiAgICAgICAgICAgIjNpWlktLUd0eFpaNTU2ZWRTZ1pxdUIiLA0KICAgICJNdWx0aS1waG90byI6ICAgICAgICJGWFJDZHNMNFVMSGV2dGJ6IiwNCiAgICAiU3R5bGUtdHJhbnNmZXIiOiAgICAiSGJxckJtc3RsUGJ6OVZ4TSIsDQogICAgIlZpZGVvIjogICAgICAgICAgICAgImZtVEE0bDBYZlFYVGFqR0kiLA0KICAgICJGYWNlLXN3YXAiOiAgICAgICAgICJxS3lPbVhETlBOdkc5V0g5IiwNCiAgICAiUmVtb3ZlLWJnIjogICAgICAgICAiejI5Qng5Q1JYS3ZjSGd2SSIsDQogICAgIkVuaGFuY2UiOiAgICAgICAgICAgIkxmcmE5OHpZaUdBMHlLbUQiLA0KICAgICJUZXh0LXRvLWltYWdlIjogICAgICJRUDM3am1CWUNwZWFDellWIiwNCiAgICAiQm90LXN0YXJ0LWhhbmRsZXIiOiAiRzUySDJnb1p6cEZTTFVTYSIsDQogICAgIkFkbWluLXN0YXRzIjogICAgICAgInFnTjdXMURYUFR6WUtVOGQiLA0KICAgICJBZGQtc3RhcnMiOiAgICAgICAgICJRNE5ENTNMVjlwVWR2aVA1IiwNCiAgICAiQmxvY2stdXNlciI6ICAgICAgICAiS2lZVExvSDJlSVBtRTRhTiIsDQogICAgIkRlbGV0ZS11c2VyIjogICAgICAgInA2QWVza0ZoNjdyb0xPUlEiLA0KfQ0KDQpHRU5FUkFUSU9OX1dPUktGTE9XUyA9IFsNCiAgICAiU3R5bGl6ZSIsICJNdWx0aS1waG90byIsICJTdHlsZS10cmFuc2ZlciIsICJWaWRlbyIsDQogICAgIkZhY2Utc3dhcCIsICJSZW1vdmUtYmciLCAiRW5oYW5jZSIsICJUZXh0LXRvLWltYWdlIg0KXQ0KDQpXRUJIT09LX0VORFBPSU5UUyA9IFsNCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlIiwNCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLW11bHRpIiwNCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLXN0eWxlLXRyYW5zZmVyIiwNCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLXZpZGVvIiwNCiAgICAiaHR0cHM6Ly9uOG4uY3JlYXRpdmVhbmFseXRpYy5ydS93ZWJob29rL2dlbmVyYXRlLWZhY2Utc3dhcCIsDQogICAgImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUvd2ViaG9vay9nZW5lcmF0ZS1yZW1vdmUtYmciLA0KICAgICJodHRwczovL244bi5jcmVhdGl2ZWFuYWx5dGljLnJ1L3dlYmhvb2svZ2VuZXJhdGUtZW5oYW5jZSIsDQogICAgImh0dHBzOi8vbjhuLmNyZWF0aXZlYW5hbHl0aWMucnUvd2ViaG9vay9nZW5lcmF0ZS10ZXh0LXRvLWltYWdlIiwNCl0NCg0KTUlOSUFQUF9VUkxTID0gWw0KICAgICJodHRwczovL2F2YXRhci1ib3QtbWluaWFwcC52ZXJjZWwuYXBwIiwNCiAgICAiaHR0cHM6Ly9hdmF0YXItYm90LW1pbmlhcHAudmVyY2VsLmFwcC9hc3NldHMvIiwNCl0NCg0KDQpkZWYgZ2V0X3dvcmtmbG93KHdmX2lkKToNCiAgICB1cmwgPSBmIntBUElfQkFTRX0vYXBpL3YxL3dvcmtmbG93cy97d2ZfaWR9Ig0KICAgIHJlc3AgPSByZXF1ZXN0cy5nZXQodXJsLCBoZWFkZXJzPUhFQURFUlMsIHZlcmlmeT1GYWxzZSwgdGltZW91dD0xNSkNCiAgICByZXNwLnJhaXNlX2Zvcl9zdGF0dXMoKQ0KICAgIHJldHVybiByZXNwLmpzb24oKQ0KDQoNCmRlZiBmaW5kX2ZhbF9tb2RlbF91cmwobm9kZXMpOg0KICAgIHVybHMgPSBbXQ0KICAgIGZvciBuIGluIG5vZGVzOg0KICAgICAgICBudHlwZSA9IG4uZ2V0KCJ0eXBlIiwgIiIpDQogICAgICAgIHBhcmFtcyA9IG4uZ2V0KCJwYXJhbWV0ZXJzIiwge30pDQogICAgICAgIGlmICJodHRwUmVxdWVzdCIgaW4gbnR5cGUgb3IgIkh0dHBSZXF1ZXN0IiBpbiBudHlwZToNCiAgICAgICAgICAgIHVybF92YWwgPSBwYXJhbXMuZ2V0KCJ1cmwiLCAiIikNCiAgICAgICAgICAgIGlmICJmYWwuYWkiIGluIHN0cih1cmxfdmFsKSBvciAiZmFsLnJ1biIgaW4gc3RyKHVybF92YWwpOg0KICAgICAgICAgICAgICAgIHVybHMuYXBwZW5kKHN0cih1cmxfdmFsKSkNCiAgICAgICAgaWYgImNvZGUiIGluIG50eXBlLmxvd2VyKCk6DQogICAgICAgICAgICBjb2RlID0gcGFyYW1zLmdldCgianNDb2RlIiwgIiIpIG9yIHBhcmFtcy5nZXQoImNvZGUiLCAiIikNCiAgICAgICAgICAgIGlmICJmYWwuYWkiIGluIGNvZGUgb3IgImZhbC5ydW4iIGluIGNvZGU6DQogICAgICAgICAgICAgICAgZm91bmQgPSByZS5maW5kYWxsKHIiaHR0cHM/Oi8vW15cc1wnXCJgLFwpXSpmYWxcLlteXHNcJ1wiYCxcKV0rIiwgY29kZSkNCiAgICAgICAgICAgICAgICB1cmxzLmV4dGVuZChmb3VuZCkNCiAgICAgICAgZm9yIGtleSwgdmFsIGluIHBhcmFtcy5pdGVtcygpOg0KICAgICAgICAgICAgaWYga2V5IGluICgianNDb2RlIiwgImNvZGUiKToNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWwsIHN0cikgYW5kICgiZmFsLmFpIiBpbiB2YWwgb3IgImZhbC5ydW4iIGluIHZhbCkgYW5kICJodHRwIiBpbiB2YWw6DQogICAgICAgICAgICAgICAgdXJscy5hcHBlbmQodmFsKQ0KICAgIHNlZW4gPSBzZXQoKQ0KICAgIHVuaXF1ZSA9IFtdDQogICAgZm9yIHUgaW4gdXJsczoNCiAgICAgICAgdSA9IHUucnN0cmlwKCIvIikucnN0cmlwKCI7IikNCiAgICAgICAgaWYgdSBub3QgaW4gc2VlbjoNCiAgICAgICAgICAgIHNlZW4uYWRkKHUpDQogICAgICAgICAgICB1bmlxdWUuYXBwZW5kKHUpDQogICAgcmV0dXJuIHVuaXF1ZQ0KDQoNCmRlZiBmaW5kX3dlYmhvb2tfcGF0aChub2Rlcyk6DQogICAgZm9yIG4gaW4gbm9kZXM6DQogICAgICAgIGlmICJ3ZWJob29rIiBpbiBuLmdldCgidHlwZSIsICIiKS5sb3dlcigpOg0KICAgICAgICAgICAgcGFyYW1zID0gbi5nZXQoInBhcmFtZXRlcnMiLCB7fSkNCiAgICAgICAgICAgIHBhdGggPSBwYXJhbXMuZ2V0KCJwYXRoIiwgIiIpDQogICAgICAgICAgICBpZiBwYXRoOg0KICAgICAgICAgICAgICAgIHJldHVybiBwYXRoDQogICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgY2hlY2tfc3R5bGl6ZV9wcm9tcHQobm9kZXMpOg0KICAgIGV4cGVjdGVkID0gIj17eyAkKCdFeHRyYWN0IElucHV0IERhdGEnKS5maXJzdCgpLmpzb24uc3R5bGUgfX0iDQogICAgZm9yIG4gaW4gbm9kZXM6DQogICAgICAgIHBhcmFtcyA9IG4uZ2V0KCJwYXJhbWV0ZXJzIiwge30pDQogICAgICAgIHBhcmFtc19zdHIgPSBqc29uLmR1bXBzKHBhcmFtcykNCiAgICAgICAgaWYgIkV4dHJhY3QgSW5wdXQgRGF0YSIgbm90IGluIHBhcmFtc19zdHIgb3IgInN0eWxlIiBub3QgaW4gcGFyYW1zX3N0cjoNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIGJvZHlfcGFyYW1zID0gcGFyYW1zLmdldCgiYm9keVBhcmFtZXRlcnMiLCB7fSkNCiAgICAgICAgaWYgaXNpbnN0YW5jZShib2R5X3BhcmFtcywgZGljdCk6DQogICAgICAgICAgICBwYXJhbWV0ZXJzID0gYm9keV9wYXJhbXMuZ2V0KCJwYXJhbWV0ZXJzIiwgW10pDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHBhcmFtZXRlcnMsIGxpc3QpOg0KICAgICAgICAgICAgICAgIGZvciBwIGluIHBhcmFtZXRlcnM6DQogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocCwgZGljdCkgYW5kIHAuZ2V0KCJuYW1lIikgPT0gInByb21wdCI6DQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBwLmdldCgidmFsdWUiLCAiIikuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWwgPT0gZXhwZWN0ZWQpLCB2YWwNCiAgICAgICAgaWYgInByb21wdCIgaW4gcGFyYW1zOg0KICAgICAgICAgICAgdmFsID0gcGFyYW1zWyJwcm9tcHQiXQ0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWwsIHN0cikgYW5kICJzdHlsZSIgaW4gdmFsOg0KICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zdHJpcCgpDQogICAgICAgICAgICAgICAgcmV0dXJuICh2YWwgPT0gZXhwZWN0ZWQpLCB2YWwNCiAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwociciIm5hbWUiIlxzKjpcXHMqIiJwcm9tcHQiIltefV0qPyIidmFsdWUiIlxzKjpccyoiIigoPzpbXiIiXFxdfFxcLikqKSIiJywgcGFyYW1zX3N0cikNCiAgICAgICAgZm9yIG0gaW4gbWF0Y2hlczoNCiAgICAgICAgICAgIGlmICJzdHlsZSIgaW4gbToNCiAgICAgICAgICAgICAgICBtX2NsZWFuID0gbS5yZXBsYWNlKCJcXG4iLCAiXG4iKS5zdHJpcCgpDQogICAgICAgICAgICAgICAgcmV0dXJuIChtX2NsZWFuID09IGV4cGVjdGVkKSwgbV9jbGVhbg0KICAgIHJldHVybiBOb25lLCAiTk9UIEZPVU5EIg0KDQoNCmRlZiBjaGVja19zdHlsaXplX2d1aWRhbmNlX3NjYWxlKG5vZGVzKToNCiAgICBmb3IgbiBpbiBub2RlczoNCiAgICAgICAgcGFyYW1zID0gbi5nZXQoInBhcmFtZXRlcnMiLCB7fSkNCiAgICAgICAgcGFyYW1zX3N0ciA9IGpzb24uZHVtcHMocGFyYW1zKQ0KICAgICAgICBpZiAiZ3VpZGFuY2Vfc2NhbGUiIGluIHBhcmFtc19zdHI6DQogICAgICAgICAgICBpZiAiY3JlYXRpdml0eSIgaW4gcGFyYW1zX3N0cjoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgY2hlY2tfYm90X3N0YXJ0X2NyZWF0ZV90b3BpY3Mobm9kZXMpOg0KICAgIG5vZGUgPSBOb25lDQogICAgZm9yIG4gaW4gbm9kZXM6DQogICAgICAgIG5hbWUgPSBuLmdldCgibmFtZSIsICIiKQ0KICAgICAgICBpZiAiY3JlYXRlIiBpbiBuYW1lLmxvd2VyKCkgYW5kICJ0b3BpYyIgaW4gbmFtZS5sb3dlcigpOg0KICAgICAgICAgICAgbm9kZSA9IG4NCiAgICAgICAgICAgIGJyZWFrDQogICAgaWYgbm90IG5vZGU6DQogICAgICAgIHJldHVybiBOb25lLCAiTm9kZSBDcmVhdGUgQWxsIFRvcGljcyBub3QgZm91bmQiDQogICAgcGFyYW1zID0gbm9kZS5nZXQoInBhcmFtZXRlcnMiLCB7fSkNCiAgICBjb2RlID0gcGFyYW1zLmdldCgianNDb2RlIiwgIiIpIG9yIHBhcmFtcy5nZXQoImNvZGUiLCAiIikNCiAgICBpZiAibGV0IHNxbCA9ICIgaW4gY29kZSBhbmQgIlNFTEVDVCAxIiBpbiBjb2RlOg0KICAgICAgICByZXR1cm4gVHJ1ZSwgIkNvbnRhaW5zOiBsZXQgc3FsIHdpdGggU0VMRUNUIDEiDQogICAgZWxpZiAibGV0IHNxbCA9ICIgaW4gY29kZToNCiAgICAgICAgZm9yIGxpbmUgaW4gY29kZS5zcGxpdCgiXG4iKToNCiAgICAgICAgICAgIGlmICJsZXQgc3FsIiBpbiBsaW5lOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSwgZiJGb3VuZDoge2xpbmUuc3RyaXAoKX0iDQogICAgICAgIHJldHVybiBGYWxzZSwgInNxbCBmb3VuZCBidXQgdW5leHBlY3RlZCB2YWx1ZSINCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gRmFsc2UsICJzcWwgYXNzaWdubWVudCBub3QgZm91bmQgaW4gY29kZSINCg0KDQpkZWYgc2VwKGNoYXI9Ij0iLCBsZW5ndGg9MTAwKToNCiAgICBwcmludChjaGFyICogbGVuZ3RoKQ0KDQoNCmRlZiBtYWluKCk6DQogICAgc2VwKCkNCiAgICBwcmludCgiICBDT01QUkVIRU5TSVZFIENIRUNLIE9GIEFMTCBXT1JLRkxPV1MgQU5EIE1JTkkgQVBQIikNCiAgICBzZXAoKQ0KICAgIHByaW50KCkNCg0KICAgIHByaW50KCJQQVJUIDE6IE44TiBXT1JLRkxPVyBDSEVDSyIpDQogICAgc2VwKCItIikNCiAgICBwcmludCgpDQoNCiAgICByZXN1bHRzID0gW10NCiAgICBmb3Igd2ZfbmFtZSwgd2ZfaWQgaW4gV09SS0ZMT1dTLml0ZW1zKCk6DQogICAgICAgIHByaW50KGYiICBGZXRjaGluZzoge3dmX25hbWV9ICh7d2ZfaWR9KS4uLiIpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHdmID0gZ2V0X3dvcmtmbG93KHdmX2lkKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBwcmludChmIiAgICBbRkFJTF0gQ291bGQgbm90IGZldGNoOiB7ZX0iKQ0KICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoeyJuYW1lIjogd2ZfbmFtZSwgImlkIjogd2ZfaWQsICJmZXRjaF9lcnJvciI6IHN0cihlKX0pDQogICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIG5vZGVzID0gd2YuZ2V0KCJub2RlcyIsIFtdKQ0KICAgICAgICBhY3RpdmUgPSB3Zi5nZXQoImFjdGl2ZSIsIEZhbHNlKQ0KICAgICAgICByZWFsX25hbWUgPSB3Zi5nZXQoIm5hbWUiLCAiPz8/IikNCiAgICAgICAgbm9kZV9jb3VudCA9IGxlbihub2RlcykNCiAgICAgICAgd2ViaG9va19wYXRoID0gZmluZF93ZWJob29rX3BhdGgobm9kZXMpDQoNCiAgICAgICAgciA9IHsNCiAgICAgICAgICAgICJuYW1lIjogd2ZfbmFtZSwgInJlYWxfbmFtZSI6IHJlYWxfbmFtZSwgImlkIjogd2ZfaWQsDQogICAgICAgICAgICAiYWN0aXZlIjogYWN0aXZlLCAibm9kZV9jb3VudCI6IG5vZGVfY291bnQsICJ3ZWJob29rX3BhdGgiOiB3ZWJob29rX3BhdGgsDQogICAgICAgICAgICAiZmFsX3VybHMiOiBbXSwgInByb21wdF9vayI6IE5vbmUsICJwcm9tcHRfdmFsIjogTm9uZSwNCiAgICAgICAgICAgICJndWlkYW5jZV9vayI6IE5vbmUsICJib3Rfc3RhcnRfb2siOiBOb25lLCAiYm90X3N0YXJ0X2RldGFpbCI6IE5vbmUsDQogICAgICAgIH0NCg0KICAgICAgICBpZiB3Zl9uYW1lIGluIEdFTkVSQVRJT05fV09SS0ZMT1dTOg0KICAgICAgICAgICAgclsiZmFsX3VybHMiXSA9IGZpbmRfZmFsX21vZGVsX3VybChub2RlcykNCg0KICAgICAgICBpZiB3Zl9uYW1lID09ICJTdHlsaXplIjoNCiAgICAgICAgICAgIHJbInByb21wdF9vayJdLCByWyJwcm9tcHRfdmFsIl0gPSBjaGVja19zdHlsaXplX3Byb21wdChub2RlcykNCiAgICAgICAgICAgIHJbImd1aWRhbmNlX29rIl0gPSBjaGVja19zdHlsaXplX2d1aWRhbmNlX3NjYWxlKG5vZGVzKQ0KDQogICAgICAgIGlmIHdmX25hbWUgPT0gIkJvdC1zdGFydC1oYW5kbGVyIjoNCiAgICAgICAgICAgIHJbImJvdF9zdGFydF9vayJdLCByWyJib3Rfc3RhcnRfZGV0YWlsIl0gPSBjaGVja19ib3Rfc3RhcnRfY3JlYXRlX3RvcGljcyhub2RlcykNCg0KICAgICAgICByZXN1bHRzLmFwcGVuZChyKQ0KDQogICAgcHJpbnQoKQ0KICAgIHNlcCgiPSIpDQogICAgcHJpbnQoIiAgV09SS0ZMT1cgU1RBVFVTIFRBQkxFIikNCiAgICBzZXAoIj0iKQ0KICAgIHByaW50KCkNCg0KICAgIGZvciByIGluIHJlc3VsdHM6DQogICAgICAgIGlmIHIuZ2V0KCJmZXRjaF9lcnJvciIpOg0KICAgICAgICAgICAgcHJpbnQoZiIgIHtyWyduYW1lJ106MjVzfSAgSUQ6IHtyWydpZCddfSIpDQogICAgICAgICAgICBwcmludChmIiAgICBbRkFJTF0gRXJyb3I6IHtyWydmZXRjaF9lcnJvciddfSIpDQogICAgICAgICAgICBwcmludCgpDQogICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIGFjdGl2ZV9pY29uID0gIltPS10gICIgaWYgclsiYWN0aXZlIl0gZWxzZSAiW0ZBSUxdIg0KICAgICAgICBwcmludChmIiAge3JbJ25hbWUnXToyNXN9ICBSZWFsIG5hbWU6IHtyWydyZWFsX25hbWUnXX0iKQ0KICAgICAgICBwcmludChmIiAgICBJRDogICAgICAgICAgICB7clsnaWQnXX0iKQ0KICAgICAgICBwcmludChmIiAgICBBY3RpdmU6ICAgICAgICB7YWN0aXZlX2ljb259ICAoe3JbJ2FjdGl2ZSddfSkiKQ0KICAgICAgICBwcmludChmIiAgICBOb2RlczogICAgICAgICB7clsnbm9kZV9jb3VudCddfSIpDQogICAgICAgIHByaW50KGYiICAgIFdlYmhvb2sgcGF0aDogIHtyWyd3ZWJob29rX3BhdGgnXSBvciAnTi9BJ30iKQ0KDQogICAgICAgIGlmIHJbIm5hbWUiXSBpbiBHRU5FUkFUSU9OX1dPUktGTE9XUzoNCiAgICAgICAgICAgIGlmIHJbImZhbF91cmxzIl06DQogICAgICAgICAgICAgICAgZm9yIHUgaW4gclsiZmFsX3VybHMiXToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgZmFsLmFpIG1vZGVsOiAge3V9IikNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgZmFsLmFpIG1vZGVsOiAgKG5vbmUgZm91bmQpIikNCg0KICAgICAgICBpZiByWyJuYW1lIl0gPT0gIlN0eWxpemUiOg0KICAgICAgICAgICAgaWYgclsicHJvbXB0X29rIl0gaXMgVHJ1ZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBQcm9tcHQgY2hlY2s6ICBbT0tdICAge3JbJ3Byb21wdF92YWwnXX0iKQ0KICAgICAgICAgICAgZWxpZiByWyJwcm9tcHRfb2siXSBpcyBGYWxzZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBQcm9tcHQgY2hlY2s6ICBbRkFJTF0ge3JbJ3Byb21wdF92YWwnXX0iKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBQcm9tcHQgY2hlY2s6ICBbPz8/P10ge3JbJ3Byb21wdF92YWwnXX0iKQ0KICAgICAgICAgICAgaWYgclsiZ3VpZGFuY2Vfb2siXSBpcyBUcnVlOg0KICAgICAgICAgICAgICAgIHByaW50KGYiICAgIEd1aWRhbmNlL2NyZWE6IFtPS10gICBndWlkYW5jZV9zY2FsZSB1c2VzIGNyZWF0aXZpdHkiKQ0KICAgICAgICAgICAgZWxpZiByWyJndWlkYW5jZV9vayJdIGlzIEZhbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KGYiICAgIEd1aWRhbmNlL2NyZWE6IFtGQUlMXSBndWlkYW5jZV9zY2FsZSBkb2VzIE5PVCB1c2UgY3JlYXRpdml0eSIpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KGYiICAgIEd1aWRhbmNlL2NyZWE6IFs/Pz8/XSBndWlkYW5jZV9zY2FsZSBub3QgZm91bmQiKQ0KDQogICAgICAgIGlmIHJbIm5hbWUiXSA9PSAiQm90LXN0YXJ0LWhhbmRsZXIiOg0KICAgICAgICAgICAgaWYgclsiYm90X3N0YXJ0X29rIl0gaXMgVHJ1ZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBDcmVhdGUgVG9waWNzOiBbT0tdICAge3JbJ2JvdF9zdGFydF9kZXRhaWwnXX0iKQ0KICAgICAgICAgICAgZWxpZiByWyJib3Rfc3RhcnRfb2siXSBpcyBGYWxzZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBDcmVhdGUgVG9waWNzOiBbRkFJTF0ge3JbJ2JvdF9zdGFydF9kZXRhaWwnXX0iKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBDcmVhdGUgVG9waWNzOiBbPz8/P10ge3JbJ2JvdF9zdGFydF9kZXRhaWwnXX0iKQ0KDQogICAgICAgIHByaW50KCkNCg0KICAgIHNlcCgiPSIpDQogICAgcHJpbnQoIiAgUEFSVCAyOiBXRUJIT09LIEVORFBPSU5UIENIRUNLIikNCiAgICBzZXAoIj0iKQ0KICAgIHByaW50KCkNCg0KICAgIGZvciB1cmwgaW4gV0VCSE9PS19FTkRQT0lOVFM6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0cy5vcHRpb25zKHVybCwgdmVyaWZ5PUZhbHNlLCB0aW1lb3V0PTEwKQ0KICAgICAgICAgICAgc3RhdHVzID0gcmVzcC5zdGF0dXNfY29kZQ0KICAgICAgICAgICAgaWNvbiA9ICJbRkFJTF0iIGlmIHN0YXR1cyA9PSA0MDQgZWxzZSAiW09LXSAgIg0KICAgICAgICAgICAgcHJpbnQoZiIgIHtpY29ufSAge3N0YXR1c30gIHt1cmx9IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgcHJpbnQoZiIgIFtGQUlMXSAgRVJSICB7dXJsfSAgKHtlfSkiKQ0KDQogICAgcHJpbnQoKQ0KDQogICAgc2VwKCI9IikNCiAgICBwcmludCgiICBQQVJUIDM6IE1JTkkgQVBQIEFWQUlMQUJJTElUWSBDSEVDSyIpDQogICAgc2VwKCI9IikNCiAgICBwcmludCgpDQoNCiAgICBmb3IgdXJsIGluIE1JTklBUFBfVVJMUzoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmVzcCA9IHJlcXVlc3RzLmdldCh1cmwsIHZlcmlmeT1GYWxzZSwgdGltZW91dD0xMCkNCiAgICAgICAgICAgIHN0YXR1cyA9IHJlc3Auc3RhdHVzX2NvZGUNCiAgICAgICAgICAgIGljb24gPSAiW09LXSAgIiBpZiBzdGF0dXMgPT0gMjAwIGVsc2UgIltGQUlMXSINCiAgICAgICAgICAgIHByaW50KGYiICB7aWNvbn0gIHtzdGF0dXN9ICB7dXJsfSIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHByaW50KGYiICBbRkFJTF0gIEVSUiAge3VybH0gICh7ZX0pIikNCg0KICAgIHByaW50KCkNCiAgICBzZXAoIj0iKQ0KICAgIHByaW50KCIgIENIRUNLIENPTVBMRVRFIikNCiAgICBzZXAoIj0iKQ0KDQogICAgcHJpbnQoKQ0KICAgIHByaW50KCJTVU1NQVJZOiIpDQogICAgc2VwKCItIikNCiAgICB0b3RhbCA9IGxlbihyZXN1bHRzKQ0KICAgIGFjdGl2ZV9jb3VudCA9IHN1bSgxIGZvciByIGluIHJlc3VsdHMgaWYgci5nZXQoImFjdGl2ZSIpKQ0KICAgIGZldGNoX2Vycm9ycyA9IFtyWyJuYW1lIl0gZm9yIHIgaW4gcmVzdWx0cyBpZiByLmdldCgiZmV0Y2hfZXJyb3IiKV0NCiAgICBpbmFjdGl2ZSA9IFtyWyJuYW1lIl0gZm9yIHIgaW4gcmVzdWx0cyBpZiBub3Qgci5nZXQoImFjdGl2ZSIpIGFuZCBub3Qgci5nZXQoImZldGNoX2Vycm9yIildDQogICAgcHJpbnQoZiIgIFRvdGFsIHdvcmtmbG93czogICAge3RvdGFsfSIpDQogICAgcHJpbnQoZiIgIEFjdGl2ZTogICAgICAgICAgICAge2FjdGl2ZV9jb3VudH0iKQ0KICAgIHByaW50KGYiICBJbmFjdGl2ZTogICAgICAgICAgIHtsZW4oaW5hY3RpdmUpfSIpDQogICAgcHJpbnQoZiIgIEZldGNoIGVycm9yczogICAgICAge2xlbihmZXRjaF9lcnJvcnMpfSIpDQogICAgaWYgaW5hY3RpdmU6DQogICAgICAgIHByaW50KGYiICBJbmFjdGl2ZSBsaXN0OiAgICAgIHsnICwgJy5qb2luKGluYWN0aXZlKX0iKQ0KICAgIGlmIGZldGNoX2Vycm9yczoNCiAgICAgICAgcHJpbnQoZiIgIEVycm9yIGxpc3Q6ICAgICAgICAgeycgLCAnLmpvaW4oZmV0Y2hfZXJyb3JzKX0iKQ0KICAgIHByaW50KCkNCg0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIG1haW4oKQ0K\"\n$bytes = [System.Convert]::FromBase64String\\($b64\\)\n$text = [System.Text.Encoding]::UTF8.GetString\\($bytes\\)\n[System.IO.File]::WriteAllText\\(\"C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\full_check_all.py\", $text, \\(New-Object System.Text.UTF8Encoding $false\\)\\)\nWrite-Host \"Written $\\($text.Length\\) chars\"\n}\"\nPS1EOF)",
      "Bash(printf:*)",
      "Bash(powershell.exe -NoProfile -Command \"Set-Content -Path ''C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\tmp_b64.txt'' -Value ''dGVzdA=='' -NoNewline\")",
      "Bash(powershell.exe -NoProfile -Command \"'''' | Set-Content -Path ''C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\full_check_all.py'' -NoNewline\")",
      "Bash(powershell.exe -NoProfile -Command \"\n@''\n#!/usr/bin/env python3\n### Comprehensive check of ALL n8n workflows and mini app.\n\nimport requests\nimport json\nimport re\nimport urllib3\nurllib3.disable_warnings\\(urllib3.exceptions.InsecureRequestWarning\\)\n\nAPI_BASE = ''https://n8n.creativeanalytic.ru''\nAPI_KEY = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY''\nHEADERS = {''X-N8N-API-KEY'': API_KEY, ''Accept'': ''application/json''}\n\nWORKFLOWS = {\n    ''Stylize'':           ''3iZY--GtxZZ556edSgZquB'',\n    ''Multi-photo'':       ''FXRCdsL4ULHevtbz'',\n    ''Style-transfer'':    ''HbqrBmstlPbz9VxM'',\n    ''Video'':             ''fmTA4l0XfQXTajGI'',\n    ''Face-swap'':         ''qKyOmXDNPNvG9WH9'',\n    ''Remove-bg'':         ''z29Bx9CRXKvcHgvI'',\n    ''Enhance'':           ''Lfra98zYiGA0yKmD'',\n    ''Text-to-image'':     ''QP37jmBYCpeaCzYV'',\n    ''Bot-start-handler'': ''G52H2goZzpFSLUSa'',\n    ''Admin-stats'':       ''qgN7W1DXPTzYKU8d'',\n    ''Add-stars'':         ''Q4ND53LV9pUdviP5'',\n    ''Block-user'':        ''KiYTLoH2eIPmE4aN'',\n    ''Delete-user'':       ''p6AeskFh67roLORQ'',\n}\n\nGENERATION_WORKFLOWS = [\n    ''Stylize'', ''Multi-photo'', ''Style-transfer'', ''Video'',\n    ''Face-swap'', ''Remove-bg'', ''Enhance'', ''Text-to-image''\n]\n\nWEBHOOK_ENDPOINTS = [\n    ''https://n8n.creativeanalytic.ru/webhook/generate'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-multi'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-style-transfer'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-video'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-face-swap'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-remove-bg'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-enhance'',\n    ''https://n8n.creativeanalytic.ru/webhook/generate-text-to-image'',\n]\n\nMINIAPP_URLS = [\n    ''https://avatar-bot-miniapp.vercel.app'',\n    ''https://avatar-bot-miniapp.vercel.app/assets/'',\n]\n''@ | Set-Content -Path ''C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\full_check_all.py'' -Encoding UTF8\n\")",
      "Bash(\"c:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\\\\test_gemini_workflow.py\" << 'ENDPYTHON'\n# -*- coding: utf-8 -*-\n\"\"\"\nТестирование Gemini Workflow\n\"\"\"\nimport json\nimport urllib.request\nimport ssl\nimport sys\nimport base64\n\nif sys.platform == 'win32':\n    sys.stdout.reconfigure\\(encoding='utf-8'\\)\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\n\nN8N = \"https://n8n.creativeanalytic.ru\"\nWEBHOOK_URL = f\"{N8N}/webhook/generate-gemini-style\"\n\nprint\\(\"=== Тест Gemini Workflow ===\\\\n\"\\)\n\n# Test data \\(small test images as URLs\\)\ntest_payload = {\n    \"user_id\": \"test123\",\n    \"mode\": \"gemini_style\",\n    \"image_url\": \"https://via.placeholder.com/150\",\n    \"style_reference_image_url\": \"https://via.placeholder.com/200\",\n    \"prompt\": \"test generation\",\n    \"init_data\": \"test\"\n}\n\nprint\\(\"Отправка тестового запроса...\"\\)\nprint\\(f\"URL: {WEBHOOK_URL}\"\\)\nprint\\(f\"Payload: {json.dumps\\(test_payload, indent=2\\)}\\\\n\"\\)\n\ntry:\n    req = urllib.request.Request\\(WEBHOOK_URL, method=\"POST\"\\)\n    req.add_header\\(\"Content-Type\", \"application/json\"\\)\n    \n    data = json.dumps\\(test_payload\\).encode\\('utf-8'\\)\n    resp = urllib.request.urlopen\\(req, data=data, context=ctx, timeout=120\\)\n    result = json.load\\(resp\\)\n    \n    print\\(\"✓ Запрос успешен!\"\\)\n    print\\(f\"\\\\nОтвет:\"\\)\n    print\\(json.dumps\\(result, indent=2, ensure_ascii=False\\)\\)\n    \nexcept urllib.error.HTTPError as e:\n    error_body = e.read\\(\\).decode\\('utf-8'\\)\n    print\\(f\"✗ HTTP Error {e.code}\"\\)\n    print\\(f\"Response: {error_body[:500]}\"\\)\n    \nexcept Exception as e:\n    print\\(f\"✗ Ошибка: {e}\"\\)\n\nprint\\(\"\\\\n\" + \"=\"*50\\)\nprint\\(\"Если видите ошибку - скопируйте её и отправьте мне\"\\)\nENDPYTHON)",
      "Bash(create_db_tables.py << 'ENDOFFILE'\n# -*- coding: utf-8 -*-\n\"\"\"\nCreate PostgreSQL tables for NanoBanana integration\n\"\"\"\nimport json\nimport urllib.request\nimport ssl\nimport sys\n\nif sys.platform == 'win32':\n    sys.stdout.reconfigure\\(encoding='utf-8'\\)\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\n\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nN8N = \"https://n8n.creativeanalytic.ru\"\n\nprint\\(\"=== СОЗДАНИЕ ТАБЛИЦ В POSTGRESQL ===\\\\n\"\\)\n\n# Load workflow\nprint\\(\"[1/3] Загрузка workflow для создания таблиц...\"\\)\nwith open\\('workflow_create_tables_ONE_TIME.json', 'r', encoding='utf-8'\\) as f:\n    wf = json.load\\(f\\)\n\n# Remove read-only fields\nfor field in ['active', 'id', 'createdAt', 'updatedAt', 'versionId']:\n    wf.pop\\(field, None\\)\n\nprint\\(\"✓ Workflow загружен\"\\)\n\n# Upload workflow\nprint\\(\"\\\\n[2/3] Загрузка workflow на n8n...\"\\)\n\ntry:\n    req = urllib.request.Request\\(f\"{N8N}/api/v1/workflows\", method=\"POST\"\\)\n    req.add_header\\(\"X-N8N-API-KEY\", API_KEY\\)\n    req.add_header\\(\"Content-Type\", \"application/json\"\\)\n\n    data = json.dumps\\(wf\\).encode\\('utf-8'\\)\n    resp = urllib.request.urlopen\\(req, data=data, context=ctx\\)\n    result = json.load\\(resp\\)\n\n    wf_id = result['id']\n    print\\(f\"✓ Workflow создан: {result['name']}\"\\)\n    print\\(f\"  ID: {wf_id}\"\\)\n\nexcept urllib.error.HTTPError as e:\n    error_body = e.read\\(\\).decode\\('utf-8'\\)\n    if 'already exists' in error_body or 'duplicate' in error_body.lower\\(\\):\n        print\\(\"⚠ Workflow уже существует, используем существующий...\"\\)\n        # Try to find existing workflow\n        try:\n            req = urllib.request.Request\\(f\"{N8N}/api/v1/workflows\"\\)\n            req.add_header\\(\"X-N8N-API-KEY\", API_KEY\\)\n            resp = urllib.request.urlopen\\(req, context=ctx\\)\n            workflows = json.load\\(resp\\)\n\n            for w in workflows['data']:\n                if 'Create NanoBanana Tables' in w['name'] or 'ONE-TIME' in w['name']:\n                    wf_id = w['id']\n                    print\\(f\"✓ Найден существующий workflow: {w['name']}\"\\)\n                    print\\(f\"  ID: {wf_id}\"\\)\n                    break\n            else:\n                print\\(\"❌ Не найден существующий workflow\"\\)\n                sys.exit\\(1\\)\n        except Exception as e:\n            print\\(f\"❌ Ошибка поиска: {e}\"\\)\n            sys.exit\\(1\\)\n    else:\n        print\\(f\"❌ HTTP Error {e.code}: {error_body}\"\\)\n        sys.exit\\(1\\)\n\nexcept Exception as e:\n    print\\(f\"❌ Ошибка: {e}\"\\)\n    import traceback\n    traceback.print_exc\\(\\)\n    sys.exit\\(1\\)\n\n# Execute workflow manually\nprint\\(f\"\\\\n[3/3] Выполнение workflow для создания таблиц...\"\\)\n\nprint\\(f\"\\\\n📋 ОТКРОЙТЕ В БРАУЗЕРЕ:\"\\)\nprint\\(f\"https://n8n.creativeanalytic.ru/workflow/{wf_id}\"\\)\nprint\\(\"\\\\nНажмите кнопку 'Test workflow' чтобы создать таблицы\"\\)\nprint\\(\"\\\\n✅ После выполнения таблицы будут созданы в PostgreSQL!\"\\)\n\nENDOFFILE)",
      "Bash(update_callback_workflow.py << 'ENDOFFILE'\n# -*- coding: utf-8 -*-\nimport json\nimport urllib.request\nimport ssl\nimport sys\n\nif sys.platform == 'win32':\n    sys.stdout.reconfigure\\(encoding='utf-8'\\)\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\n\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nN8N = \"https://n8n.creativeanalytic.ru\"\nWF_ID = \"kEK3jebINGSAGNFR\"\n\nprint\\(\"=== ОБНОВЛЕНИЕ CALLBACK WORKFLOW ===\\\\n\"\\)\n\nwith open\\('workflow_nanobanana_callback.json', 'r', encoding='utf-8'\\) as f:\n    wf = json.load\\(f\\)\n\nfor field in ['active', 'id', 'createdAt', 'updatedAt', 'versionId']:\n    wf.pop\\(field, None\\)\n\nprint\\(\"✓ Исправлены connections:\"\\)\nprint\\(\"  - TRUE \\(success\\) → Send Photo\"\\)\nprint\\(\"  - FALSE \\(error\\) → Send Error\"\\)\n\nprint\\(f\"\\\\nОбновление workflow {WF_ID}...\"\\)\n\ntry:\n    req = urllib.request.Request\\(f\"{N8N}/api/v1/workflows/{WF_ID}\", method=\"PUT\"\\)\n    req.add_header\\(\"X-N8N-API-KEY\", API_KEY\\)\n    req.add_header\\(\"Content-Type\", \"application/json\"\\)\n\n    data = json.dumps\\(wf\\).encode\\('utf-8'\\)\n    resp = urllib.request.urlopen\\(req, data=data, context=ctx\\)\n    result = json.load\\(resp\\)\n\n    print\\(f\"\\\\n✅ Callback workflow обновлен!\"\\)\n    print\\(f\"  ID: {result['id']}\"\\)\n    print\\(f\"  Активен: {result.get\\('active', False\\)}\"\\)\n\nexcept Exception as e:\n    print\\(f\"\\\\n❌ Ошибка: {e}\"\\)\n    sys.exit\\(1\\)\n\nprint\\(\"\\\\n✅ ГОТОВО!\"\\)\nENDOFFILE)",
      "Bash(final_verification.py << 'ENDOFFILE'\n# -*- coding: utf-8 -*-\nimport json\nimport urllib.request\nimport ssl\nimport sys\n\nif sys.platform == 'win32':\n    sys.stdout.reconfigure\\(encoding='utf-8'\\)\n\nctx = ssl.create_default_context\\(\\)\nctx.check_hostname = False\nctx.verify_mode = ssl.CERT_NONE\n\nAPI_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\nN8N = \"https://n8n.creativeanalytic.ru\"\n\nprint\\(\"=\" * 70\\)\nprint\\(\"ФИНАЛЬНАЯ ПРОВЕРКА ИНТЕГРАЦИИ NANOBANANA\"\\)\nprint\\(\"=\" * 70\\)\n\nworkflows_to_check = {\n    \"Nyrs3xgCsNiw6a3o\": \"generate-nanobanana\",\n    \"kEK3jebINGSAGNFR\": \"nanobanana-callback\"\n}\n\nall_ok = True\n\nfor wf_id, wf_name in workflows_to_check.items\\(\\):\n    print\\(f\"\\\\n[{wf_name}]\"\\)\n    try:\n        req = urllib.request.Request\\(f\"{N8N}/api/v1/workflows/{wf_id}\"\\)\n        req.add_header\\(\"X-N8N-API-KEY\", API_KEY\\)\n        resp = urllib.request.urlopen\\(req, context=ctx\\)\n        wf = json.load\\(resp\\)\n        \n        is_active = wf.get\\('active', False\\)\n        node_count = len\\(wf.get\\('nodes', []\\)\\)\n        \n        print\\(f\"  Статус: {'✅ АКТИВЕН' if is_active else '❌ НЕАКТИВЕН'}\"\\)\n        print\\(f\"  Нод: {node_count}\"\\)\n        print\\(f\"  ID: {wf_id}\"\\)\n        \n        if wf_name == \"generate-nanobanana\":\n            webhook_node = next\\(\\(n for n in wf['nodes'] if n['type'] == 'n8n-nodes-base.webhook'\\), None\\)\n            if webhook_node:\n                webhook_path = webhook_node['parameters'].get\\('path', ''\\)\n                print\\(f\"  Webhook: {N8N}/webhook/{webhook_path}\"\\)\n            \n            has_balance_node = next\\(\\(n for n in wf['nodes'] if n['id'] == 'has-balance'\\), None\\)\n            if has_balance_node:\n                connections = wf['connections'].get\\('has-balance', {}\\).get\\('main', []\\)\n                if len\\(connections\\) >= 2:\n                    true_path = connections[0][0]['node'] if connections[0] else None\n                    false_path = connections[1][0]['node'] if connections[1] else None\n                    print\\(f\"  IF connections:\"\\)\n                    print\\(f\"    TRUE → {true_path}\"\\)\n                    print\\(f\"    FALSE → {false_path}\"\\)\n                    \n                    if true_path == \"call-nanobanana\" and false_path == \"no-balance\":\n                        print\\(f\"  ✅ Connections ПРАВИЛЬНЫЕ\"\\)\n                    else:\n                        print\\(f\"  ❌ Connections НЕПРАВИЛЬНЫЕ!\"\\)\n                        all_ok = False\n        \n        if wf_name == \"nanobanana-callback\":\n            webhook_node = next\\(\\(n for n in wf['nodes'] if n['type'] == 'n8n-nodes-base.webhook'\\), None\\)\n            if webhook_node:\n                webhook_path = webhook_node['parameters'].get\\('path', ''\\)\n                print\\(f\"  Webhook: {N8N}/webhook/{webhook_path}\"\\)\n            \n            check_success_node = next\\(\\(n for n in wf['nodes'] if n['id'] == 'check-success'\\), None\\)\n            if check_success_node:\n                connections = wf['connections'].get\\('check-success', {}\\).get\\('main', []\\)\n                if len\\(connections\\) >= 2:\n                    true_path = connections[0][0]['node'] if connections[0] else None\n                    false_path = connections[1][0]['node'] if connections[1] else None\n                    print\\(f\"  IF connections:\"\\)\n                    print\\(f\"    TRUE → {true_path}\"\\)\n                    print\\(f\"    FALSE → {false_path}\"\\)\n                    \n                    if true_path == \"send-photo\" and false_path == \"send-error\":\n                        print\\(f\"  ✅ Connections ПРАВИЛЬНЫЕ\"\\)\n                    else:\n                        print\\(f\"  ❌ Connections НЕПРАВИЛЬНЫЕ!\"\\)\n                        all_ok = False\n        \n        if not is_active:\n            all_ok = False\n    \n    except Exception as e:\n        print\\(f\"  ❌ ОШИБКА: {e}\"\\)\n        all_ok = False\n\nprint\\(\"\\\\n\" + \"=\" * 70\\)\nif all_ok:\n    print\\(\"✅ ВСЕ ПРОВЕРКИ ПРОЙДЕНЫ УСПЕШНО!\"\\)\n    print\\(\"\\\\n📋 Осталось сделать вручную:\"\\)\n    print\\(\"1. Создать таблицы в PostgreSQL:\"\\)\n    print\\(f\"   https://n8n.creativeanalytic.ru/workflow/tamSpELkc8Ve5Gsm\"\\)\n    print\\(\"   Нажать 'Test workflow'\"\\)\n    print\\(\"\\\\n2. Протестировать в боте:\"\\)\n    print\\(\"   - Открыть @those_are_the_gifts_bot\"\\)\n    print\\(\"   - Выбрать режим '🌟 AI Магия'\"\\)\n    print\\(\"   - Загрузить 2-8 фото\"\\)\n    print\\(\"   - Нажать '🌟 Создать AI-аватар'\"\\)\nelse:\n    print\\(\"❌ НАЙДЕНЫ ПРОБЛЕМЫ! Проверьте детали выше.\"\\)\nprint\\(\"=\" * 70\\)\nENDOFFILE)",
      "Bash(ssh:*)",
      "Bash(powershell.exe:*)",
      "Bash(curl.exe:*)",
      "Bash($TOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJlNmQ3YzY2ZC1mOGQ2LTRkMzUtODliMS0zMGU3MDlhOGU3MjkiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwianRpIjoiMzdiNWFhNDYtOWYzNi00OWFlLWFiYzAtNDc5Zjk1NTI1YjQ4IiwiaWF0IjoxNzcxMjQyMDcxLCJleHAiOjE3Nzg5NjUyMDB9.QhNHRyI-KBBDD1tYpkqQoYZRsFsGq7LiMVH8XMUc28s\")",
      "Bash(if [ -f \"C:/Users/User/Desktop/Project/avatar-bot-miniapp/workflow_clean.json\" ])",
      "Bash(then echo \"File exists\")",
      "Bash(else echo \"File not found\")",
      "Bash(fi)",
      "WebFetch(domain:kie.ai)",
      "Bash(move:*)",
      "Bash(move tmp_gemini_workflow.json _gemini_files )",
      "Bash(move setup_gemini_final.py _gemini_files )",
      "Bash(move gemini_workflow_import.json _gemini_files )",
      "Bash(move tmp_gemini_wf_current.json _gemini_files )",
      "Bash(move current_gemini_wf.json _gemini_files )",
      "Bash(move switch_to_gemini.py _gemini_files )",
      "Bash(move gemini_final_with_downloads.json _gemini_files )",
      "Bash(move fix_gemini_workflow.py _gemini_files )",
      "Bash(move test_gemini_workflow.py _gemini_files )",
      "Bash(move gemini_models.json _gemini_files )",
      "Bash(move GEMINI_SETUP_GUIDE.md _gemini_files )",
      "Bash(move QUICK_GEMINI_SETUP.md _gemini_files)",
      "Bash(for f in create_gemini_workflow.py setup_gemini_simple.py tmp_gemini_workflow.json create_gemini_proper.py create_gemini_auto.py setup_gemini_final.py gemini_workflow_ready.json setup_gemini_clean.py gemini_workflow_import.json tmp_gemini_wf_current.json update_to_gemini_vision.py gemini_vision_workflow.json save_gemini_workflow.py apply_gemini_final.py gemini_workflow_final.json current_gemini_wf.json switch_to_gemini.py gemini_updated.json gemini_step1.json gemini_final_with_downloads.json fix_gemini_workflow.py fixed_gemini_workflow.json current_gemini_workflow.json test_gemini_workflow.py gemini_models.json test_gemini_simple.json test_gemini_ssh.md GEMINI_SETUP_GUIDE.md QUICK_GEMINI_SETUP.md)",
      "Bash(do mv \"$f\" _gemini_files/)",
      "Bash(done)",
      "WebFetch(domain:docs.kie.ai)",
      "Bash(node -e:*)",
      "Bash(nslookup:*)",
      "WebFetch(domain:openrouter.ai)",
      "WebFetch(domain:api.kie.ai)",
      "WebFetch(domain:skywork.ai)",
      "Bash(scp:*)",
      "Bash(wc:*)",
      "mcp__ide__getDiagnostics",
      "Bash(__NEW_LINE_5f0fc276e24066a9__ echo -e \"\\\\n\\\\n=== Referral stats without initData ===\")",
      "Bash(__NEW_LINE_5f0fc276e24066a9__ echo -e \"\\\\n\\\\n=== Delete generation without initData ===\")",
      "Bash(for WF_ID in z29Bx9CRXKvcHgvI Lfra98zYiGA0yKmD)",
      "Bash(do)",
      "Bash(echo:*)",
      "Bash(node:*)",
      "Bash(gh api:*)",
      "Bash(for eid in 6475 6468 6459)",
      "Bash(/tmp/find_lipsync.py:*)",
      "Bash(/tmp/SEARCH_COMPLETE.txt:*)",
      "WebSearch",
      "Bash(# Check for recent successful executions of the generate workflow curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions?workflowId=3iZY--GtxZ556edSgZQuB&limit=10\"\")",
      "Bash(# Check all recent errors across ALL workflows - not just health monitor curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions?status=error&limit=100\"\")",
      "Bash(# Check the nanobanana workflow in detail to understand why 404 despite active=true curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/workflows/Nyrs3xgCsNiw6a3o\"\")",
      "Bash(# Check what happened in bot-start-handler error 7852 \\(most recent\\) curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions/7852?includeData=true\"\")",
      "Bash(# Check generate workflow errors in detail \\(6009 series from Feb 19\\) curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions/6009?includeData=true\"\")",
      "Bash(# Check if there''s a recent successful style transfer execution curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions?workflowId=HbqrBmstlPbz9VxM&limit=10\"\")",
      "Bash(# Check Health Monitor error details to understand the root cause curl -sk -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" \"\"https://n8n.creativeanalytic.ru/api/v1/executions/8660?includeData=true\"\")",
      "Bash(for f in /tmp/exec_6015.json /tmp/exec_6014.json /tmp/exec_5993.json)",
      "Bash(# Проверим, работает ли вообще webhook upload-photo \\(второй workflow\\) curl -sk -X POST \"\"https://n8n.creativeanalytic.ru/api/v1/workflows/NP4KY0yBndN3upKVomhE1/activate\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\" -H \"\"Content-Type: application/json\"\" -d ''{}'')",
      "Bash(# Сравним webhook node конфигурацию рабочего generate vs нерабочего upload-photo for wfid in 3iZY--GtxZ556edSgZQuB FqO0ER3eF7GgbESNhfC9C NP4KY0yBndN3upKVomhE1; do curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/workflows/$wfid\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(# Проверяем, работает ли generate webhook curl -sk -X POST \"\"https://n8n.creativeanalytic.ru/webhook/generate\"\" -H ''Content-Type: application/json'' -d ''{\"\"test\"\": true}'')",
      "Bash(# Проверяем user-status webhook curl -sk -X POST \"\"https://n8n.creativeanalytic.ru/webhook/user-status\"\" -H ''Content-Type: application/json'' -d ''{\"\"user_id\"\": \"\"test123\"\", \"\"init_data\"\": \"\"\"\"}'')",
      "Bash(# Проверяем create-invoice webhook curl -sk -X POST \"\"https://n8n.creativeanalytic.ru/webhook/create-invoice\"\" -H ''Content-Type: application/json'' -d ''{\"\"test\"\": true}'')",
      "Bash(# Проверяем generate-style-transfer и generate-video — как они вызывают Kie.ai for wfid in HbqrBmstlPbz9VxM fmTA4l0XfQXTajGI; do curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/workflows/$wfid\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(# Проверяем running/waiting executions curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/executions?status=running&limit=10\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(# Проверяем waiting executions curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/executions?status=waiting&limit=10\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(# Все новейшие execution-ы по всем workflow-ам curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/executions?limit=10\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(# Проверяем текущий код Prepare Kie Request + полную цепочку отправки curl -sk \"\"https://n8n.creativeanalytic.ru/api/v1/workflows/3iZY--GtxZ556edSgZQuB\"\" -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzcwNjUwNzk0LCJleHAiOjE3NzMyMDE2MDB9.UVG3WEUUhsglQ8h4SZ92jp1JzTcJ_UQYiSp6r0Fk7jY\"\")",
      "Bash(for id_name in \"fmTA4l0XfQXTajGI:video\" \"whdEwP3wRDredCOw:lipsync\" \"QP37jmBYCpeaCzYV:text2img\" \"Lfra98zYiGA0yKmD:enhance\" \"z29Bx9CRXKvcHgvI:removebg\" \"FXRCdsL4ULHevtbz:multi\" \"Nyrs3xgCsNiw6a3o:nanobanana\" \"qKyOmXDNPNvG9WH9:faceswap\")",
      "Bash(name=\"$id_name##*:\")",
      "Bash(PYTHONIOENCODING=utf-8 python3:*)",
      "WebFetch(domain:avatar-bot-miniapp.vercel.app)",
      "Bash(cd /c/Users/User/Desktop/Project/avatar-bot-miniapp && npx netlify deploy --prod --dir=dist 2>&1)",
      "Bash(echo === $ID ===:*)",
      "Bash(echo === Latest executions per workflow ===:*)",
      "Bash(echo === S3 bucket root ===:*)",
      "mcp__n8n-mcp__n8n_validate_workflow",
      "mcp__n8n-mcp__tools_documentation",
      "mcp__n8n-mcp__n8n_workflow_versions",
      "mcp__n8n-mcp__n8n_autofix_workflow",
      "mcp__n8n-mcp__n8n_update_partial_workflow",
      "mcp__n8n-mcp__n8n_get_workflow",
      "mcp__n8n-mcp__n8n_health_check",
      "mcp__n8n-mcp__n8n_list_workflows",
      "mcp__n8n-mcp__n8n_executions",
      "Bash(cygpath:*)",
      "mcp__n8n-mcp__n8n_create_workflow",
      "mcp__n8n-mcp__n8n_test_workflow",
      "Bash(API_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3YjlmMzhmMC0wZGZlLTQwNGEtYTY3Ny1iYTU0MGJiZjUwYzEiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwianRpIjoiZGI1NGJhN2YtMDFhMi00OWFmLTk4ZDAtNDMxNmIyYmE2NTZkIiwiaWF0IjoxNzcxODYxOTU4LCJleHAiOjE3NzQ0MTEyMDB9.RC3l1g2S7b6wbywfZbCQtGZ3n3iB4Ydn3AqclRtVp9I\" && curl -k -s -X POST \"https://n8n.creativeanalytic.ru/api/v1/executions\" -H \"Content-Type: application/json\" -H \"X-N8N-API-KEY: $API_KEY\" -d \"{\\\\\"workflowId\\\\\":\\\\\"AiVLnEjNduBjCgUq\\\\\"}\" --max-time 60 2>&1)",
      "mcp__n8n-mcp__n8n_delete_workflow",
      "mcp__n8n-mcp__search_nodes",
      "Bash(tail:*)",
      "WebFetch(domain:ai.google.dev)",
      "mcp__n8n-mcp__n8n_update_full_workflow",
      "Bash(cd:*)",
      "mcp__n8n-mcp__get_node",
      "WebFetch(domain:kieai.erweima.ai)",
      "Bash(pandoc:*)",
      "Bash(PYTHONUTF8=1 python3:*)",
      "Bash(cd \"C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\" && git stash 2>&1)",
      "Bash(cd \"C:\\\\Users\\\\User\\\\Desktop\\\\Project\\\\avatar-bot-miniapp\" && git checkout -b feature/photosession 2>&1)",
      "Bash(head:*)",
      "Bash(xxd:*)",
      "Bash(docker ps:*)",
      "Bash(sort:*)",
      "Bash(cat:*)",
      "Bash(ssh server-main:*)",
      "Bash(echo === Workflow: $wf_id ===:*)",
      "Bash(\"/c/Users/User/AppData/Local/Programs/Python/Python314/python.exe\":*)",
      "Bash(curl:*)"
    ]
  },
  "enableAllProjectMcpServers": true,
  "enabledMcpjsonServers": [
    "n8n-mcp"
  ]
}
