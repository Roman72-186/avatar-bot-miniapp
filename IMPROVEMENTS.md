# AI DEVELOPERS -- 5 пунктов улучшения

Дата анализа: 2026-02-22
Анализируемые файлы: App.jsx, 16 компонентов, 4 утилиты, styles.css, index.html

---

## 1. Onboarding-воронка и стартовый экран для новых пользователей

**Описание:**
Сейчас новый пользователь сразу попадает на главный экран с 8 режимами генерации (grid 2x4), слайдером креативности, загрузкой фото и т.д. Это информационная перегрузка -- человек не понимает, с чего начать, и уходит.

Нужен экран первого запуска (onboarding), который:
- Показывает 2-3 слайда с примерами результатов (до/после для каждого режима)
- Объясняет систему звезд ("1 бесплатная стилизация каждый день, дальше -- звезды")
- Предлагает сразу попробовать бесплатную стилизацию (конкретный CTA -- "Попробовать бесплатно")
- После первой успешной генерации показывает приглашение в реферальную программу

**Обоснование:**
Конверсия "открыл приложение -> сделал первую генерацию" критична для любого freemium-продукта. Без onboarding большая часть новых пользователей уходит, не разобравшись. Кроме того, бесплатные генерации (free_stylize, free_remove_bg, free_enhance) -- сильный хук, но пользователь может их не заметить среди 8 вкладок. Маленький бейдж "FREE" в углу 11px-кнопки легко пропустить.

Дополнительно, сейчас в `ModeSelector` все 8 режимов отображаются одинаково, без разделения на "простые/дешевые" и "продвинутые/дорогие". Новый пользователь может случайно выбрать Lip Sync (250 звезд) или видео (155-620 звезд), увидеть что у него нет баланса, и уйти разочарованным.

**Что конкретно сделать:**
- Компонент `OnboardingScreen` с 3 слайдами (свайп или кнопка "Далее")
- Флаг `localStorage.getItem('onboarding_done')` чтобы показывать один раз
- Группировка режимов в ModeSelector: "Базовые" (Стилизация, Убрать фон, Улучшить, Текст в фото) и "Продвинутые" (Мульти-фото, Референс, Видео, Lip Sync) с визуальным разделением
- После первой генерации -- popup "Пригласи друга и получи звезды" (сейчас реферальный экран спрятан за маленькую кнопку "Рефералы")

**Сложность:** Средне (3-4 дня)

---

## 2. Пакетные тарифы и автопополнение вместо поштучной покупки звезд

**Описание:**
Текущий модальный экран пополнения (`showTopUp`) предлагает купить 10/25/50/100 звезд с произвольным вводом. Это линейная покупка без выгоды -- пользователь не мотивирован купить больше. Нет ни скидок, ни бонусов, ни пакетов.

Нужно переработать монетизацию:
- Пакеты со скидками: "50 звезд", "150 звезд (+10% бонус)", "500 звезд (+25% бонус)"
- Подписочная модель: "Безлимит на базовые функции за X звезд/месяц"
- Бандлы по режимам: "5 генераций видео по цене 4"
- Визуальная подсказка "самый популярный" на среднем пакете

**Обоснование:**
Средний чек критичен. Покупка 10 звезд -- это 1 стилизация и ничего больше. Пользователь не чувствует ценности. Пакеты с бонусами ("+25% бесплатно") доказано повышают средний чек на 40-60% в мобильных приложениях. Кроме того, сейчас пользователь видит модальное окно пополнения только когда у него уже кончились звезды и он хочет генерировать -- это момент фрустрации, худшее время для продажи. Нужны проактивные предложения.

**Что конкретно изменить в коде:**
- Переработать модалку `showTopUp` в `App.jsx` (строки 702-734): заменить grid 4 кнопок на карточки пакетов с описанием выгоды
- Добавить бейдж "Выгодно!" или "Популярный" на средний пакет
- В `GenerateButton.jsx` при `!canAfford` показывать не просто "Пополнить баланс", а конкретное предложение "Купи 50 звезд -- хватит на 6 стилизаций"
- Добавить в `ResultScreen.jsx` после успешной генерации: "Понравилось? Купи пакет со скидкой" если баланс < 20

**Сложность:** Средне (2-3 дня фронтенд + настройка тарифов в n8n)

---

## 3. Галерея примеров и превью стилей с реальными результатами

**Описание:**
Сейчас выбор стиля в `StyleSelector` -- это grid из 4 карточек с emoji и текстом (Аниме, Пиксель-арт, GTA, 3D Мультяшный). Пользователь не видит, что получит в итоге. То же касается всех остальных режимов -- нет визуальных примеров.

Нужно:
- Для каждого стиля в `StyleSelector` показывать миниатюру реального результата (до/после)
- Для каждого режима в `ModeSelector` добавить возможность нажать на info-иконку и увидеть 2-3 примера результатов
- Общая галерея лучших работ (community showcase) -- мотивация попробовать

**Обоснование:**
"Покажи, не рассказывай" -- главный принцип конверсии. Сейчас стили описаны текстом и emoji. Пользователь видит "GTA" с emoji пистолета и "Стиль загрузочных экранов GTA" -- но не видит, как будет выглядеть ЕГО фото в этом стиле. Превью реальных результатов увеличивают конверсию выбора стиля в 2-3 раза. Кроме того, всего 4 стиля -- это мало. Конкуренты предлагают 20-30. Но даже 4 стиля с хорошими превью конвертируют лучше 20 стилей без них.

**Что конкретно сделать:**
- В `styles.js` добавить поле `previewUrl` к каждому стилю (ссылка на S3 с примером результата)
- В `StyleSelector.jsx` заменить `style-emoji` (32px emoji) на миниатюру изображения с fallback на emoji
- Добавить 4-8 новых стилей (Cyberpunk, Watercolor, Comics, Oil Painting и т.д.) -- промпты уже есть в открытых источниках
- В `ModeSelector` добавить маленькую иконку "?" рядом с каждым режимом, по нажатию -- bottom sheet с 2-3 примерами

**Сложность:** Средне (3-4 дня: подготовка изображений, верстка, загрузка на S3)

---

## 4. Очередь генерации и устойчивость к таймаутам

**Описание:**
Текущая архитектура синхронная: фронтенд делает POST в n8n webhook и ждет ответа до 300 секунд (5 минут для видео). Если пользователь закроет Mini App, свернет Telegram или потеряет связь -- результат теряется. Деньги списаны, результата нет. Это видно в `api.js`: таймаут 180-300 секунд, retry только на сетевые ошибки, без механизма проверки статуса.

Нужен асинхронный pipeline:
1. Фронтенд отправляет запрос, получает `task_id` мгновенно
2. Бот присылает результат в чат когда генерация готова
3. Фронтенд опционально поллит статус для показа прогресса

**Обоснование:**
Судя по коду, частично это уже реализовано -- есть `SentScreen` с текстом "Результат отправлен в чат с ботом". Но этот flow работает не для всех режимов (видно по `handleGenerate` в App.jsx, строки 346-376: сначала проверяется `data?.sent`, потом fallback на `image_url`/`video_url`). Это значит что часть генераций все еще зависит от того, что пользователь не закроет приложение 1-5 минут. Для видео (до 5 минут ожидания) и style_transfer (300 секунд таймаут) это критично.

Кроме того, `apiRequest` делает retry с экспоненциальным backoff (2s, 4s), но retry на генерацию может привести к двойному списанию звезд -- в коде нет idempotency key.

**Что конкретно сделать:**
- Перевести ВСЕ режимы на async flow: фронтенд получает `{ task_id, status: "queued" }`, показывает SentScreen, бот присылает результат
- Добавить в `api.js` генерацию `idempotency_key` (uuid v4) для каждого запроса генерации, передавать его в n8n, на бэкенде проверять дубли
- Убрать таймауты 180-300 секунд (они не нужны если flow асинхронный)
- Опционально: добавить polling endpoint `task-status/{task_id}` для отображения прогресса в реальном времени, но это не обязательно если бот надежно доставляет результат

**Сложность:** Сложно (5-7 дней: изменения в n8n workflows + бот + фронтенд)

---

## 5. Push-уведомления через бота и система "ежедневных подарков"

**Описание:**
Сейчас удержание пользователей держится на бесплатных генерациях (free_stylize, free_remove_bg, free_enhance -- обновляются ежедневно) и реферальной программе. Но нет активного механизма возврата пользователя. Если человек не открывает Mini App самостоятельно -- он забывает о нем.

Нужно:
- Ежедневное push-уведомление через бота: "Ваша бесплатная генерация обновилась! Попробуйте новый стиль [Cyberpunk]"
- Система streak: "3 дня подряд -- бонусные 5 звезд", "7 дней -- 15 звезд"
- Еженедельный дайджест: "На этой неделе в тренде: стиль Anime (+45% генераций)"
- Промо-акции: "Сегодня Lip Sync со скидкой 30%"

**Обоснование:**
Retention -- главная метрика для Mini App. Согласно данным Telegram, 70% пользователей Mini App не возвращаются после первого использования. Push через бота -- самый эффективный канал: open rate 60-80% (против 20-30% у email). Бродкаст-механизм уже реализован в `AdminPanel.jsx` (broadcastSend/broadcastPreview), но он ручной. Нужна автоматизация.

Streak-система создает привычку. Сейчас бесплатные генерации обновляются молча -- пользователь не знает об этом, пока не откроет приложение. Уведомление "Ваша бесплатная генерация ждет!" + streak-бонус -- проверенный паттерн (Duolingo, Snapchat, мобильные игры).

**Что конкретно сделать:**
- На бэкенде (n8n/PostgreSQL): добавить таблицу `user_streaks` (user_id, current_streak, last_active_date, total_streak_bonus)
- n8n cron-workflow: каждый день в 10:00 отправлять сообщение через бота пользователям, у которых free_stylize > 0 и которые не генерировали вчера
- На фронтенде: компонент `StreakBanner` на главном экране: "День 3 -- завтра бонус 5 звезд!"
- В `loadUserStatus` (App.jsx): получать streak-данные с сервера и показывать
- Автоматические скидки по расписанию: "Пятница -- день видео, -20% на photo_to_video"

**Сложность:** Средне-Сложно (4-6 дней: n8n cron + таблица в PostgreSQL + бот-логика + фронтенд-баннер)

---

## Сводная таблица

| # | Улучшение | Фокус | Сложность | Срок | Ожидаемый эффект |
|---|-----------|-------|-----------|------|------------------|
| 1 | Onboarding-воронка | UX/UI | Средне | 3-4 дня | +30-50% конверсия первой генерации |
| 2 | Пакетные тарифы | Монетизация | Средне | 2-3 дня | +40-60% средний чек |
| 3 | Галерея примеров стилей | UX/UI | Средне | 3-4 дня | +2-3x конверсия выбора стиля |
| 4 | Async-очередь генерации | Надежность | Сложно | 5-7 дней | -80% потерянных генераций |
| 5 | Push-уведомления и streak | Удержание | Средне-Сложно | 4-6 дней | +40-60% Day-7 retention |

## Рекомендованный порядок реализации

1. **Пункт 4 (Async-очередь)** -- без этого пользователи теряют оплаченные генерации, это репутационный урон
2. **Пункт 1 (Onboarding)** -- увеличивает воронку на входе, все остальные улучшения бессмысленны без первой генерации
3. **Пункт 3 (Галерея примеров)** -- низкий effort, высокий impact на конверсию
4. **Пункт 2 (Пакетные тарифы)** -- монетизация после того как воронка настроена
5. **Пункт 5 (Push и streak)** -- работает на масштабе, когда уже есть база пользователей

## Дополнительные наблюдения (не вошли в топ-5)

**Технический долг:**
- `App.jsx` содержит ~780 строк с 30+ useState -- это "God Component". Стоит вынести логику генерации в custom hook `useGeneration()`, состояние режимов в `useModeState()`, а модалки в отдельные компоненты
- Одинаковый паттерн `const data = Array.isArray(result) ? result[0] : result` повторяется в 15+ местах -- n8n возвращает то массив, то объект. Стоит нормализовать на уровне `apiRequest`
- В `styles.js` указана модель `fal-ai/face-to-sticker`, но в `api.js` используется S3 + n8n + Kie.ai. Файл `styles.js` содержит устаревшие константы (`STARS_PER_GENERATION = 5`, `FREE_GENERATIONS_PER_DAY = 3`), которые не используются в основном коде, но импортируются в `GenerateButton.jsx`
- CSS файл -- 2379 строк в одном файле. При росте проекта стоит разделить на модули (или перейти на CSS Modules)

**Безопасность:**
- Пароль админки передается в открытом виде через `apiRequest('admin-stats', { password })`. Стоит перейти на токен-based аутентификацию с TTL
- `initData` передается во все запросы, но нет видимой валидации на стороне фронтенда (предполагается что n8n валидирует -- стоит убедиться)

**Недоступная функциональность:**
- Режим `ai_magic` (NanoBanana) закомментирован в `modes.js` (строки 92-103), но код API для него живет в `api.js` (функция `generateNanoBanana`). Стоит либо удалить мертвый код, либо довести функцию до рабочего состояния
- Функция `generateGeminiStyle` в `api.js` (строки 354-392) не используется нигде в компонентах -- мертвый код
